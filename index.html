<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LEXIUM | Gesti√≥n Legal Inteligente</title>
    <link rel="stylesheet" href="assets/fonts/fonts.css">
    <link rel="stylesheet" href="assets/fa/css/all.min.css">
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/rediseno.css">

</head>

<body>

    <!-- ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà
         HTML ‚Äî BLOQUE 1: SIDEBAR (men√∫ lateral de navegaci√≥n)
    ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà -->
    <aside id="side">
        <div class="logo">
            <img src="data:image/png;base64,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"
                alt="LEXIUM" class="logo-img">
            <div class="logo-brand">
                <div class="logo-name">LEXIUM</div>
                <div class="logo-tag">Legal Intelligence</div>
            </div>
            <span id="backup-badge" style="display:none;"></span>
        </div>
        <!-- Usuario activo -->
        <div class="sidebar-user" id="sidebar-user-info">
            <div class="sidebar-user-avatar" id="su-avatar">A</div>
            <div class="sidebar-user-info">
                <div class="sidebar-user-name" id="su-nombre">Administrador</div>
                <div class="sidebar-user-role" id="su-rol">Admin</div>
            </div>
        </div>
        <nav>
            <!-- üìä HUB 1: PANEL -->
            <button class="act" onclick="tab('panel',this)"><i class="fas fa-chart-line"></i> Dashboard</button>

            <!-- üìÅ HUB 2: EXPEDIENTES -->
            <button class="nav-group-header"
                onclick="this.classList.toggle('open'); document.getElementById('nav-items-expedientes').classList.toggle('open')"><i
                    class="fas fa-folder grp-icon"></i> <span>Expedientes</span> <i
                    class="fas fa-chevron-right nav-group-chevron"></i></button>
            <div class="nav-group-items" id="nav-items-expedientes">
                <button onclick="tab('causas',this)"><i class="fas fa-gavel"></i> Gesti√≥n de Causas</button>
                <button onclick="tab('causas-pro',this)"><i class="fas fa-sitemap"></i> Causas Pro</button>
                <button onclick="tab('detalle-causa',this)"><i class="fas fa-folder-open"></i> Detalle Causa</button>
                <button onclick="tab('instancias',this)"><i class="fas fa-sitemap"></i> Instancias</button>
                <button onclick="tab('recursos',this)"><i class="fas fa-undo"></i> Recursos</button>
                <button onclick="tab('prescripcion',this)"><i class="fas fa-hourglass-half"></i> Prescripci√≥n</button>
                <button onclick="tab('archivos',this)"><i class="fas fa-archive"></i> Gestor de Archivos</button>
            </div>

            <!-- üß† HUB 3: INTELIGENCIA -->
            <button class="nav-group-header"
                onclick="this.classList.toggle('open'); document.getElementById('nav-items-inteligencia').classList.toggle('open')"><i
                    class="fas fa-brain grp-icon"></i> <span>Inteligencia</span> <i
                    class="fas fa-chevron-right nav-group-chevron"></i></button>
            <div class="nav-group-items" id="nav-items-inteligencia">
                <button onclick="tab('estrategia',this)"><i class="fas fa-brain"></i> Estrategia & Riesgo</button>
                <button onclick="tab('calculadora',this)"><i class="fas fa-calendar-alt"></i> Calculadora
                    Plazos</button>
                <button onclick="tab('calculadora-pro',this)"><i class="fas fa-calculator"></i> Calculadora Pro</button>
                <button onclick="tab('doctrina',this)"><i class="fas fa-graduation-cap"></i> Doctrina</button>
            </div>

            <!-- ‚úçÔ∏è HUB 4: PRODUCCI√ìN -->
            <button class="nav-group-header"
                onclick="this.classList.toggle('open'); document.getElementById('nav-items-produccion').classList.toggle('open')"><i
                    class="fas fa-pen-nib grp-icon"></i> <span>Producci√≥n</span> <i
                    class="fas fa-chevron-right nav-group-chevron"></i></button>
            <div class="nav-group-items" id="nav-items-produccion">
                <button onclick="tab('escritos',this)"><i class="fas fa-pen-nib"></i> Generador Escritos</button>
                <button onclick="tab('plantillas-escritos',this)"><i class="fas fa-layer-group"></i> Plantillas</button>
                <button onclick="tab('timesheet',this)"><i class="fas fa-stopwatch"></i> Timesheet</button>
            </div>

            <!-- üíº HUB 5: NEGOCIO -->
            <button class="nav-group-header"
                onclick="this.classList.toggle('open'); document.getElementById('nav-items-negocio').classList.toggle('open')"><i
                    class="fas fa-briefcase grp-icon"></i> <span>Negocio</span> <i
                    class="fas fa-chevron-right nav-group-chevron"></i></button>
            <div class="nav-group-items" id="nav-items-negocio">
                <button onclick="tab('clientes',this)"><i class="fas fa-users"></i> Clientes</button>
                <button onclick="tab('honorarios',this)"><i class="fas fa-wallet"></i> Honorarios</button>
                <button onclick="tab('prospectos',this)"><i class="fas fa-funnel-dollar"></i> Prospectos CRM</button>
            </div>

            <!-- üõ†Ô∏è HUB 6: SISTEMA -->
            <button class="nav-group-header"
                onclick="this.classList.toggle('open'); document.getElementById('nav-items-sistema').classList.toggle('open')"><i
                    class="fas fa-tools grp-icon"></i> <span>Sistema</span> <i
                    class="fas fa-chevron-right nav-group-chevron"></i></button>
            <div class="nav-group-items" id="nav-items-sistema">
                <button onclick="tab('calendario',this)"><i class="fas fa-calendar-week"></i> Agenda & Alertas</button>
                <button onclick="tab('admin-usuarios',this)"><i class="fas fa-users-cog"></i> Usuarios</button>
                <button onclick="tab('config-ia',this)"><i class="fas fa-robot"></i> Config. IA</button>
                <button onclick="tab('bitacora',this)"><i class="fas fa-shield-alt"></i> Bit√°cora</button>
                <button onclick="tab('seccion-whatsapp', this)"><i class="fab fa-whatsapp"></i> WhatsApp</button>
            </div>

            <div class="nav-divider"></div>
            <button onclick="importarBackup()" class="nav-bottom-btn"><i class="fas fa-upload"></i> Importar
                Backup</button>
            <button onclick="BackupDisco.hacerAhora('manual')" class="nav-bottom-btn nav-bottom-btn--highlight"
                title="Guardar backup ahora">
                <i class="fas fa-download"></i> Backup ahora
            </button>
            <div id="backup-disco-estado" class="sb-status">Cargando...</div>
            <div class="nav-divider"></div>
            <button onclick="DocFisico.elegirCarpeta()" class="nav-bottom-btn"
                title="Establece la carpeta raiz donde se organizan documentos, backups y exportaciones">
                <i class="fas fa-folder"></i> Carpeta de la app
            </button>
            <button onclick="DocFisico.sincronizarTodo()" class="nav-bottom-btn nav-bottom-btn--small"
                title="Copia todos los adjuntos existentes a la carpeta de documentos">
                <i class="fas fa-sync"></i> Sincronizar docs a disco
            </button>
            <div id="docfisico-estado" class="sb-status">Sin carpeta de docs</div>
            <button onclick="logout()" class="nav-bottom-btn nav-logout-btn"><i class="fas fa-sign-out-alt"></i> Cerrar
                Sesi√≥n</button>
        </nav>
    </aside>

    <main id="main">
        <div id="hub-nav-container" class="container" style="display:none;"></div>
        <!-- LOGIN SPLIT SCREEN -->
        <div id="login-screen">
            <!-- Left panel: dark brand -->
            <div class="login-left">
                <!-- Canvas: part√≠culas + mesh + balanza wireframe -->
                <canvas id="login-canvas" aria-hidden="true"></canvas>

                <!-- Bloque institucional central -->
                <div class="login-left-hero" aria-hidden="true">
                    <span class="login-left-hero-eyebrow">Plataforma LegalTech</span>
                    <div class="login-left-hero-divider"></div>
                    <h2 class="login-left-hero-title">
                        Tecnolog√≠a que potencia<br>el ejercicio del <em>Derecho.</em>
                    </h2>
                    <p class="login-left-hero-sub">
                        Gesti√≥n jur√≠dica moderna, segura y eficiente<br>para profesionales del derecho.
                    </p>
                    <div class="login-left-pillars">
                        <span class="login-left-pillar"><i class="fas fa-lock"></i>Cifrado extremo a extremo</span>
                        <span class="login-left-pillar"><i class="fas fa-shield-alt"></i>Privacidad garantizada</span>
                        <span class="login-left-pillar"><i class="fas fa-server"></i>Datos locales</span>
                    </div>
                </div>

                <div class="login-left-logo">
                    <img src="data:image/png;base64,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"
                        alt="LEXIUM">
                    <span class="login-left-logo-name">LEXIUM</span>
                </div>
                <div class="login-left-content">
                    <h1 class="login-left-headline">Gesti√≥n legal<br>inteligente y moderna</h1>
                    <p class="login-left-desc">Administra tus casos, documentos, plazos y finanzas en una sola
                        plataforma dise√±ada para profesionales del derecho.</p>
                </div>
                <div class="login-left-footer">¬© 2026 LEXIUM. Todos los derechos reservados.</div>
            </div>
            <!-- Right panel: form -->
            <div class="login-right">
                <div class="login-form-wrap">
                    <h2 class="login-title">Iniciar sesi√≥n</h2>
                    <p class="login-subtitle">Selecciona tu usuario para acceder</p>
                    <div id="login-user-list" class="login-user-list">
                        <div style="text-align:center;color:var(--text-3);font-size:13px;padding:12px;">Cargando
                            usuarios...</div>
                    </div>
                    <div id="login-pw-block" class="login-pw-block">
                        <button class="login-back-btn" onclick="loginVolver()">‚Üê Cambiar usuario</button>
                        <div style="margin-bottom:6px;">
                            <label id="login-pw-label" style="margin-top:0;">Contrase√±a</label>
                            <input type="password" id="pw" placeholder="Ingresa tu contrase√±a"
                                onkeydown="if(event.key==='Enter') auth()" style="font-size:14px;">
                        </div>
                        <button onclick="auth()" class="btn btn-p btn-full"
                            style="height:44px;font-size:15px;border-radius:8px;"><i class="fas fa-unlock-alt"></i>
                            Ingresar</button>
                    </div>
                    <p id="err" style="color:var(--danger);font-size:13px;margin-top:10px;text-align:center;"></p>
                    <p style="text-align:center;margin-top:10px;">
                        <button id="btn-reset-bloqueo" onclick="resetBloqueo()"
                            style="display:none;background:none;border:none;color:var(--text-3);font-size:12px;cursor:pointer;text-decoration:underline;">
                            ¬øSistema bloqueado? Clic aqu√≠
                        </button>
                    </p>
                </div>
            </div>
        </div>

        <!-- TOAST NOTIFICATIONS -->
        <div id="toast-container"></div>

        <!-- ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà
             HTML ‚Äî BLOQUE 2: APP PRINCIPAL (topbar + todas las secciones)
        ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà -->
        <!-- APP -->
        <div id="app" style="display:none;">
            <!-- TOPBAR -->
            <div id="topbar">
                <button class="topbar-toggle" onclick="toggleSidebar()" title="Toggle sidebar">
                    <i class="fas fa-bars"></i>
                </button>
                <div class="topbar-search">
                    <i class="fas fa-search topbar-search-icon"></i>
                    <input type="text" class="topbar-search-input" placeholder="Buscar causas, clientes, documento..."
                        id="topbar-search-input" oninput="if(typeof busquedaGlobal==='function')tab('busqueda',null)">
                </div>
                <div class="topbar-spacer"></div>
                <button id="btn-guardar-global" onclick="guardarCambiosGlobal()" title="Guardar cambios">
                    <i class="fas fa-save"></i> <span>Guardar</span>
                </button>
                <span id="storage-usage-badge" class="topbar-storage-badge" title="Uso de almacenamiento local">
                    <i class="fas fa-database" style="font-size:10px;"></i> <span id="storage-text">Local</span>
                </span>
                <button class="topbar-bell" onclick="toggleTheme()" title="Cambiar Tema (Claro/Oscuro)">
                    <i class="fas fa-moon" id="theme-icon"></i>
                </button>
                <button class="topbar-bell" title="Notificaciones"
                    onclick="if(typeof notifTogglePanel==='function')notifTogglePanel()">
                    <i class="fas fa-bell"></i>
                    <span class="topbar-bell-dot"></span>
                </button>
                <div class="topbar-user">
                    <div class="topbar-avatar" id="topbar-avatar">A</div>
                    <div class="topbar-info">
                        <div class="topbar-name" id="topbar-name">Administrador</div>
                        <div class="topbar-email" id="topbar-email">admin@appbogado.com</div>
                        <div class="topbar-phone" id="topbar-phone"
                            style="font-size:11px;color:var(--text-3);display:none;"></div>
                    </div>
                </div>
            </div>
        </div>
        <!-- ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
             SECCIONES DE CONTENIDO ‚Äî dentro de #app para que hereden
             display:none en login y display:block tras autenticaci√≥n
        ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->

        <!-- PANEL -->
        <section id="panel" class="tabs active">

            <!-- ‚îÄ‚îÄ DASHBOARD HEADER ‚îÄ‚îÄ -->
            <div class="db-header">
                <div class="db-header-left">
                    <h2 class="db-title"><i class="fas fa-chart-line" style="color:var(--cyan);margin-right:8px;"></i>
                        Dashboard Judicial</h2>
                    <p class="db-subtitle">Vista general de tu operaci√≥n legal</p>
                </div>
                <div class="db-header-right">
                    <div class="modo-toggle">
                        <button class="modo-btn activo" id="modo-personal-btn"
                            onclick="setModo('personal')">Personal</button>
                        <button class="modo-btn" id="modo-estudio-btn" onclick="setModo('estudio')">Estudio</button>
                    </div>
                    <button class="db-export-btn" onclick="exportarPDFEconomico()">
                        <i class="fas fa-download"></i> PDF
                    </button>
                </div>
            </div>

            <!-- ‚îÄ‚îÄ FILTROS ‚îÄ‚îÄ -->
            <div class="db-filtros" id="db-filtros">
                <span class="db-filtro-icon"><i class="fas fa-filter"></i></span>
                <div class="db-filtro-group">
                    <label>Rama</label>
                    <select id="flt-rama" onchange="renderDashboardPanel()">
                        <option value="">Todas las Ramas</option>
                        <option>Civil</option>
                        <option>Laboral</option>
                        <option>Familia</option>
                        <option>Penal</option>
                        <option>Comercial</option>
                    </select>
                </div>
                <div class="db-filtro-group">
                    <label>Estado</label>
                    <select id="flt-estado" onchange="renderDashboardPanel()">
                        <option value="">Todos los Estados</option>
                        <option>En tramitaci√≥n</option>
                        <option>Finalizada</option>
                        <option>Suspendida</option>
                    </select>
                </div>
                <div class="db-filtro-group">
                    <label>Instancia</label>
                    <select id="flt-instancia" onchange="renderDashboardPanel()">
                        <option value="">Todas las Instancias</option>
                        <option>Primera</option>
                        <option>Segunda</option>
                        <option>Casaci√≥n</option>
                    </select>
                </div>
                <button class="db-clear-btn" onclick="limpiarFiltrosPanel()"><i class="fas fa-times"></i>
                    Limpiar</button>
            </div>

            <!-- ‚îÄ‚îÄ KPI ROW ‚îÄ‚îÄ -->
            <div class="db-kpi-row" id="db-kpi-row">
                <div class="db-kpi db-kpi-blue">
                    <div class="db-kpi-icon"><i class="fas fa-gavel"></i></div>
                    <div class="db-kpi-data">
                        <span class="db-kpi-val" id="kpi-causas">0</span>
                        <span class="db-kpi-label">Causas Activas</span>
                    </div>
                    <div class="db-kpi-trend" id="kpi-causas-trend"></div>
                </div>
                <div class="db-kpi db-kpi-red">
                    <div class="db-kpi-icon"><i class="fas fa-exclamation-triangle"></i></div>
                    <div class="db-kpi-data">
                        <span class="db-kpi-val" id="kpi-alertas">0</span>
                        <span class="db-kpi-label">Alertas Cr√≠ticas</span>
                    </div>
                    <div class="db-kpi-trend" id="kpi-alertas-trend"></div>
                </div>
                <div class="db-kpi db-kpi-slate">
                    <div class="db-kpi-icon"><i class="fas fa-users"></i></div>
                    <div class="db-kpi-data">
                        <span class="db-kpi-val" id="kpi-clientes">0</span>
                        <span class="db-kpi-label">Clientes</span>
                    </div>
                </div>
                <div class="db-kpi db-kpi-slate">
                    <div class="db-kpi-icon"><i class="fas fa-chart-line"></i></div>
                    <div class="db-kpi-data">
                        <span class="db-kpi-val" id="kpi-avance">0%</span>
                        <span class="db-kpi-label">Avance Promedio</span>
                    </div>
                </div>
                <div class="db-kpi db-kpi-green">
                    <div class="db-kpi-icon"><i class="fas fa-dollar-sign"></i></div>
                    <div class="db-kpi-data">
                        <span class="db-kpi-val" id="kpi-facturado" style="font-size:1.1rem;">$0</span>
                        <span class="db-kpi-label">Total Facturado</span>
                    </div>
                </div>
                <div class="db-kpi db-kpi-orange">
                    <div class="db-kpi-icon"><i class="fas fa-hourglass-half"></i></div>
                    <div class="db-kpi-data">
                        <span class="db-kpi-val" id="kpi-pendiente" style="font-size:1.1rem;">$0</span>
                        <span class="db-kpi-label">Pendiente Cobro</span>
                    </div>
                </div>
            </div>

            <!-- ‚îÄ‚îÄ CHARTS ROW 1: Donuts ‚îÄ‚îÄ -->
            <div class="db-charts-row">
                <div class="db-chart-card">
                    <div class="db-chart-header">
                        <h3><i class="fas fa-circle-notch"></i> Causas por Estado</h3>
                    </div>
                    <div class="db-donut-wrap">
                        <svg id="donut-estado" viewBox="0 0 160 160" width="160" height="160"></svg>
                        <div class="db-donut-legend" id="legend-estado"></div>
                    </div>
                </div>
                <div class="db-chart-card">
                    <div class="db-chart-header">
                        <h3><i class="fas fa-circle-notch"></i> Causas por Instancia</h3>
                    </div>
                    <div class="db-donut-wrap">
                        <svg id="donut-instancia" viewBox="0 0 160 160" width="160" height="160"></svg>
                        <div class="db-donut-legend" id="legend-instancia"></div>
                    </div>
                </div>
                <div class="db-chart-card">
                    <div class="db-chart-header">
                        <h3><i class="fas fa-circle-notch"></i> Alertas por Prioridad</h3>
                    </div>
                    <div class="db-donut-wrap">
                        <svg id="donut-alertas" viewBox="0 0 160 160" width="160" height="160"></svg>
                        <div class="db-donut-legend" id="legend-alertas"></div>
                    </div>
                </div>
            </div>

            <!-- ‚îÄ‚îÄ CHARTS ROW 2: Barras ‚îÄ‚îÄ -->
            <div class="db-charts-row db-charts-row-2">
                <div class="db-chart-card db-chart-wide">
                    <div class="db-chart-header">
                        <h3><i class="fas fa-chart-bar"></i> Causas por Rama</h3>
                        <div class="db-legend-pills">
                            <span class="db-pill db-pill-blue">Activas</span>
                            <span class="db-pill db-pill-red">Finalizadas</span>
                        </div>
                    </div>
                    <div id="bar-rama" class="db-bars-container"></div>
                </div>
                <div class="db-chart-card">
                    <div class="db-chart-header">
                        <h3><i class="fas fa-coins"></i> Cuant√≠a por Estado</h3>
                    </div>
                    <div id="bar-cuantia" class="db-bars-container db-bars-horizontal"></div>
                </div>
            </div>

            <!-- ‚îÄ‚îÄ ROW 3: Sem√°foro + Alertas + Dormidas ‚îÄ‚îÄ -->
            <div class="db-bottom-row">
                <div class="db-chart-card db-semaforo-card">
                    <div class="db-chart-header">
                        <h3><i class="fas fa-traffic-light"></i> Sem√°foro de Plazos</h3>
                    </div>
                    <div id="semaforo-plazos" class="semaforo-wrap" style="margin-top:4px;"></div>
                </div>
                <div class="db-chart-card db-alertas-card">
                    <div class="db-chart-header">
                        <h3><i class="fas fa-bell"></i> Monitor de Alertas</h3>
                    </div>
                    <div id="alert-container"></div>
                </div>
            </div>

            <!-- IDs legacy que otros m√≥dulos usan ‚Äî ocultos -->
            <span id="st-ca" style="display:none">0</span>
            <span id="st-pr" style="display:none">0</span>
            <span id="st-al" style="display:none">0</span>
            <span id="st-ju" style="display:none">0</span>
            <span id="st-do" style="display:none">0</span>
            <div id="panelEjecutivo" style="display:none;"></div>
            <div id="salud-widget" style="display:none;"></div>
            <div id="semaforo-global-bar" style="display:none;">
                <div id="sg-verde"></div>
                <div id="sg-amarillo"></div>
                <div id="sg-rojo"></div>
                <div id="sg-texto"></div>
                <div id="sg-cuenta"></div>
            </div>
            <div id="causas-dormidas-card" style="display:none;">
                <div id="causas-dormidas-lista"></div><small id="dormidas-count"></small>
            </div>
        </section>

        <!-- TR√ÅMITES ADMINISTRATIVOS -->
        <section id="tramites" class="tabs">
            <div id="tramites-main" style="padding: 0 0 40px 0;"></div>
        </section>

        <!-- CLIENTES -->
        <section id="clientes" class="tabs">
            <div class="hub-nav">
                <button class="hub-tab active" id="hub-tab-clientes"
                    onclick="mostrarPanelClientes('clientes-panel', this)">
                    <i class="fas fa-users"></i> Clientes</button>
                <button class="hub-tab" id="hub-tab-financiero"
                    onclick="mostrarPanelClientes('financiero-panel', this)">
                    <i class="fas fa-wallet"></i> Control Financiero</button>
            </div>

            <!-- Panel: Clientes -->
            <div id="clientes-panel" class="hub-panel">
                <div class="grid">
                    <div class="card">
                        <h3><i class="fas fa-user-plus"></i> Nuevo Prospecto / Cliente</h3>
                        <label>Nombre Completo</label>
                        <input id="cl-nom" placeholder="Ej: Juan P√©rez Gonz√°lez" oninput="uiVerificarConflicto()">
                        <label>RUT</label>
                        <input id="cl-rut" placeholder="Ej: 12.345.678-9"
                            oninput="onRutInput(this); uiVerificarConflicto()">
                        <div id="conflicto-resultado" style="margin-top:6px;"></div>
                        <label>Relato de Hechos</label>
                        <textarea id="cl-rel"
                            placeholder="Descripci√≥n de los hechos para an√°lisis de estrategia..."></textarea>
                        <button class="btn btn-s btn-full" onclick="addClient()">
                            <i class="fas fa-save"></i> Guardar Prospecto</button>
                    </div>
                    <div id="client-list">
                        <div class="empty-state"><i class="fas fa-users"></i>
                            <p>Sin clientes registrados</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Panel: Control Financiero (antes secci√≥n independiente) -->
            <div id="financiero-panel" class="hub-panel" style="display:none;">
                <div class="grid">
                    <div class="card">
                        <h3><i class="fas fa-file-invoice-dollar"></i> Asignar Honorarios a Causa</h3>
                        <label>Causa</label>
                        <select id="hr-causa-sel"></select>
                        <label>Monto Base ($)</label>
                        <input type="number" id="hr-monto" placeholder="Ej: 5000000">
                        <button class="btn btn-s btn-full" onclick="uiAsignarHonorarios()">
                            <i class="fas fa-save"></i> Asignar</button>
                        <hr style="margin:18px 0; border:none; border-top:1px solid var(--border);">
                        <h3><i class="fas fa-money-bill-wave"></i> Registrar Pago</h3>
                        <label>Causa</label>
                        <select id="hr-pago-causa-sel"></select>
                        <label>Monto del Pago ($)</label>
                        <input type="number" id="hr-pago-monto" placeholder="Ej: 1000000">
                        <button class="btn btn-p btn-full" onclick="uiRegistrarPago()">
                            <i class="fas fa-check"></i> Registrar Pago</button>
                    </div>
                    <div class="card">
                        <h3><i class="fas fa-chart-bar"></i> Estado de Honorarios por Causa</h3>
                        <div id="hr-resumen"></div>
                    </div>
                </div>
            </div>
        </section>

        <!-- CAUSAS -->
        <section id="causas" class="tabs">
            <div class="hub-nav">
                <button class="hub-tab active" onclick="tab('causas', this)"><i class="fas fa-gavel"></i>
                    Causas</button>
                <button class="hub-tab" onclick="tab('archivos', this)"><i class="fas fa-folder-open"></i>
                    Documentos</button>
                <button class="hub-tab" onclick="tab('tramites', this)"><i class="fas fa-building"></i>
                    Tr√°mites</button>
            </div>
            <div id="causa-list" class="grid">
                <div class="empty-state" style="grid-column:1/-1;"><i class="fas fa-gavel"></i>
                    <p>Sin causas activas. Convierta un prospecto en causa desde la secci√≥n Clientes.</p>
                </div>
            </div>
        </section>

        <!-- ESTRATEGIA -->
        <section id="estrategia" class="tabs">
            <div class="hub-nav">
                <button class="hub-tab active" onclick="tab('estrategia', this)"><i class="fas fa-chart-pie"></i>
                    Estrategia & Riesgo</button>
                <button class="hub-tab" onclick="tab('juris', this)"><i class="fas fa-book"></i> Jurisprudencia &
                    Doctrina</button>
            </div>
            <div class="grid">
                <div class="card">
                    <h3><i class="fas fa-chart-pie"></i> An√°lisis de Riesgo Multidimensional</h3>
                    <label>Seleccionar Causa</label>
                    <select id="risk-select" onchange="renderRisk()">
                        <option value="">-- Seleccione una causa --</option>
                    </select>
                    <div id="risk-chart" style="margin-top:16px;"></div>
                </div>
                <div class="card">
                    <h3><i class="fas fa-lightbulb"></i> Teor√≠a del Caso Sugerida</h3>
                    <div id="strategy-hint">Seleccione una causa para generar sugerencias estrat√©gicas.</div>
                </div>
            </div>
        </section>

        <!-- CALCULADORA -->
        <section id="calculadora" class="tabs">
            <div class="card" style="max-width:580px;">
                <h3><i class="fas fa-calendar-alt"></i> Calculadora de Plazos Procesales</h3>
                <label>Materia</label>
                <select id="calc-materia" onchange="updateCalcHitos()">
                    <option value="civil">Civil ‚Äî CPC (D√≠as H√°biles L-S)</option>
                    <option value="laboral">Laboral ‚Äî CT (D√≠as H√°biles L-S)</option>
                </select>
                <label>Hito Procesal</label>
                <select id="calc-hito"></select>
                <label>Fecha de Notificaci√≥n / Inicio</label>
                <input type="date" id="calc-date">
                <button class="btn btn-p btn-full" onclick="runCalc()"><i class="fas fa-calculator"></i> Calcular
                    Vencimiento</button>
                <div id="calc-res"></div>
            </div>
        </section>

        <!-- GESTOR DE ARCHIVOS -->
        <section id="archivos" class="tabs">
            <div class="hub-nav">
                <button class="hub-tab" onclick="tab('causas', this)"><i class="fas fa-gavel"></i> Causas</button>
                <button class="hub-tab active" onclick="tab('archivos', this)"><i class="fas fa-folder-open"></i>
                    Documentos</button>
                <button class="hub-tab" onclick="tab('tramites', this)"><i class="fas fa-building"></i>
                    Tr√°mites</button>
            </div>

            <!-- Selector de causa + stat r√°pido -->
            <div class="ga-header">
                <div class="ga-select-wrap">
                    <label>Causa</label>
                    <select id="ga-causa-sel" onchange="gaSelectCausa()">
                        <option value="">-- Seleccione una causa --</option>
                    </select>
                </div>
                <button class="btn btn-p" onclick="document.getElementById('file-input').click()" id="ga-upload-btn"
                    disabled>
                    <i class="fas fa-upload"></i> Subir Documento
                </button>
                <button class="btn" style="background:var(--bg-2,var(--bg));" onclick="gaToggleView()" id="ga-view-btn"
                    title="Cambiar vista">
                    <i class="fas fa-stream"></i>
                </button>
            </div>

            <div id="ga-no-causa" class="empty-state card">
                <i class="fas fa-folder-open"></i>
                <p>Seleccione una causa para acceder al gestor documental.</p>
            </div>

            <!-- Layout principal -->
            <div id="ga-main" style="display:none;">

                <!-- Upload zone + form -->
                <div class="upload-zone card" id="ga-drop-zone" onclick="document.getElementById('file-input').click()">
                    <i class="fas fa-cloud-upload-alt"></i>
                    <p>Arrastre archivos aqu√≠ o haga clic para seleccionar</p>
                    <small>PDF ¬∑ Word ¬∑ Im√°genes ¬∑ M√∫ltiples archivos</small>
                </div>
                <input type="file" id="file-input" multiple accept=".pdf,.doc,.docx,.png,.jpg,.jpeg">

                <!-- Formulario de metadatos -->
                <div class="upload-form" id="ga-form">
                    <h4><i class="fas fa-tags" style="color:var(--a)"></i> Clasificaci√≥n del Documento</h4>
                    <div id="ga-staged-files" style="margin-bottom:12px; font-size:0.82rem; color:var(--t2);"></div>
                    <div class="form-row">
                        <div>
                            <label>Tipo / Naturaleza</label>
                            <select id="ga-tipo">
                                <option value="Resoluci√≥n">Resoluci√≥n</option>
                                <option value="Escrito Propio">Escrito Propio</option>
                                <option value="Escrito Contraparte">Escrito Contraparte</option>
                                <option value="Prueba Documental">Prueba Documental</option>
                                <option value="Prueba Testimonial">Prueba Testimonial</option>
                                <option value="Prueba Pericial">Prueba Pericial</option>
                                <option value="Sentencia">Sentencia</option>
                                <option value="Recurso">Recurso</option>
                                <option value="Notificaci√≥n">Notificaci√≥n</option>
                                <option value="Otro">Otro</option>
                            </select>
                        </div>
                        <div>
                            <label>Subtipo</label>
                            <select id="ga-subtipo">
                                <option value="Traslado">Traslado</option>
                                <option value="Auto">Auto</option>
                                <option value="Interlocutoria">Interlocutoria</option>
                                <option value="Definitiva">Definitiva</option>
                                <option value="Oficio">Oficio</option>
                                <option value="Mandamiento">Mandamiento</option>
                                <option value="N/A">N/A</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div>
                            <label>Etapa Procesal</label>
                            <select id="ga-etapa">
                                <option value="01_Demanda">01 ¬∑ Demanda</option>
                                <option value="02_Resoluciones">02 ¬∑ Resoluciones</option>
                                <option value="03_Notificaciones">03 ¬∑ Notificaciones</option>
                                <option value="04.1_Prueba_Documental">04.1 ¬∑ Prueba Documental</option>
                                <option value="04.2_Prueba_Testimonial">04.2 ¬∑ Prueba Testimonial</option>
                                <option value="04.3_Prueba_Pericial">04.3 ¬∑ Prueba Pericial</option>
                                <option value="05_Escritos_Propios">05 ¬∑ Escritos Propios</option>
                                <option value="06_Escritos_Contraparte">06 ¬∑ Escritos Contraparte</option>
                                <option value="07_Recursos">07 ¬∑ Recursos</option>
                                <option value="08_Sentencia">08 ¬∑ Sentencia</option>
                                <option value="09_Ejecucion">09 ¬∑ Ejecuci√≥n</option>
                            </select>
                        </div>
                        <div>
                            <label>Fecha del Documento</label>
                            <input type="date" id="ga-fecha-doc">
                        </div>
                    </div>
                    <label>Descripci√≥n Breve</label>
                    <input id="ga-desc" placeholder="Ej: Resoluci√≥n que recibe causa a prueba">

                    <label>Impacto</label>
                    <div style="display:flex; gap:8px; flex-wrap:wrap; margin-top:4px;">
                        <label class="cb-row"><input type="checkbox" id="ga-imp-prob"> Impacto Probatorio</label>
                        <label class="cb-row"><input type="checkbox" id="ga-imp-strat"> Estrat√©gico</label>
                        <label class="cb-row"><input type="checkbox" id="ga-imp-crit"> Cr√≠tico</label>
                    </div>

                    <label class="cb-row" style="margin-top:12px; font-weight:600;">
                        <input type="checkbox" id="ga-genera-plazo" onchange="gaTogglePlazo()">
                        ¬øEste documento genera un plazo procesal?
                    </label>

                    <div class="plazo-extra" id="ga-plazo-extra">
                        <strong style="font-size:0.83rem; color:#92400e;"><i class="fas fa-calendar-exclamation"></i>
                            Configurar Plazo</strong>
                        <div class="form-row" style="margin-top:8px;">
                            <div>
                                <label>D√≠as H√°biles</label>
                                <input type="number" id="ga-dias" placeholder="Ej: 10" min="1"
                                    oninput="gaPreviewPlazo()">
                            </div>
                            <div>
                                <label>Tipo d√≠a</label>
                                <select id="ga-tipo-dia" onchange="gaPreviewPlazo()">
                                    <option value="habiles">H√°biles (L-S)</option>
                                    <option value="corridos">Corridos</option>
                                </select>
                            </div>
                        </div>
                        <div id="ga-plazo-preview"
                            style="margin-top:8px; font-size:0.82rem; color:var(--d); font-family:'DM Mono',monospace;">
                        </div>
                        <p style="font-size:0.75rem; color:#92400e; margin-top:6px;"><i class="fas fa-user-shield"></i>
                            La responsabilidad del c√°lculo es siempre del
                            abogado.</p>
                    </div>

                    <div class="ia-hint" id="ga-ia-hint">
                        <i class="fas fa-robot"></i>
                        <div id="ga-ia-text"></div>
                    </div>

                    <div style="display:flex; gap:8px; margin-top:14px;">
                        <button class="btn btn-p" onclick="gaGuardarDoc()" style="flex:1;"><i class="fas fa-save"></i>
                            Indexar Documento</button>
                        <button class="btn btn-d" onclick="gaCancelForm()"><i class="fas fa-times"></i></button>
                    </div>
                </div>

                <!-- Vista carpetas + documentos -->
                <div class="ga-layout" id="ga-doc-area">
                    <div class="folder-tree">
                        <div class="folder-tree-header"><i class="fas fa-sitemap"></i> Estructura de Causa</div>
                        <div id="ga-folder-list"></div>
                    </div>
                    <div class="ga-right">
                        <div class="doc-list" id="ga-doc-list">
                            <div class="doc-list-header">
                                <h4 id="ga-folder-title">Todos los documentos</h4>
                                <div class="doc-filters" id="ga-filters">
                                    <button class="filter-btn active" onclick="gaFilter('all',this)">Todos</button>
                                    <button class="filter-btn" onclick="gaFilter('plazo',this)">‚è∞ Con plazo</button>
                                    <button class="filter-btn" onclick="gaFilter('prob',this)">üîç
                                        Probatorio</button>
                                    <button class="filter-btn" onclick="gaFilter('strat',this)">üí°
                                        Estrat√©gico</button>
                                    <button class="filter-btn" onclick="gaFilter('crit',this)">üî¥ Cr√≠tico</button>
                                </div>
                            </div>
                            <div id="ga-items"></div>
                        </div>
                    </div>
                </div>

                <!-- Timeline + Alertas de plazos -->
                <div class="ga-layout" style="margin-top:18px;">
                    <div class="card">
                        <h3><i class="fas fa-stream"></i> L√≠nea de Tiempo Documental</h3>
                        <div id="ga-timeline" class="timeline"></div>
                    </div>
                    <div class="card">
                        <h3><i class="fas fa-exclamation-circle"></i> Alertas de Plazos</h3>
                        <div id="ga-plazos-alertas"></div>
                    </div>
                </div>
            </div>
        </section>

        <!-- JURISPRUDENCIA -->
        <section id="juris" class="tabs">
            <div class="hub-nav">
                <button class="hub-tab" onclick="tab('estrategia', this)"><i class="fas fa-chart-pie"></i>
                    Estrategia & Riesgo</button>
                <button class="hub-tab active" onclick="tab('juris', this)"><i class="fas fa-book"></i>
                    Jurisprudencia & Doctrina</button>
            </div>
            <div class="grid">
                <div class="card">
                    <h3><i class="fas fa-book-open"></i> Indexar Jurisprudencia</h3>
                    <label>Rol / Tribunal</label>
                    <input id="ju-rol" placeholder="Ej: ROL 1234-2023 / CS, 3¬™ Sala">
                    <label>Extracto Doctrinal</label>
                    <textarea id="ju-ext" placeholder="Extracto del fallo o doctrina relevante..."></textarea>
                    <label>Categor√≠a</label>
                    <select id="ju-cat">
                        <option value="Civil">Civil</option>
                        <option value="Laboral">Laboral</option>
                        <option value="Penal">Penal</option>
                        <option value="Constitucional">Constitucional</option>
                        <option value="Otra">Otra</option>
                    </select>
                    <button class="btn btn-p btn-full" onclick="addJuris()"><i class="fas fa-database"></i>
                        Indexar</button>
                </div>
                <div>
                    <div id="juris-list"></div>
                </div>
            </div>
        </section>

        <!-- HONORARIOS -->
        <section id="honorarios" class="tabs">
            <div class="card" style="max-width:500px;">
                <h3><i class="fas fa-wallet"></i> Calculadora de Honorarios Sugerida</h3>
                <label>Cuant√≠a del Asunto ($)</label>
                <input type="number" id="hon-val" placeholder="Ej: 10000000" oninput="calcHon()">
                <h2 id="hon-res">$ 0</h2>
                <p style="font-size:0.8rem; color:var(--t2); margin-bottom:12px;">Honorario m√≠nimo sugerido (modelo
                    referencial 15%‚Äì10% escalonado)</p>
                <div id="hon-table"></div>
            </div>
        </section>

        <!-- PROSPECTOS CRM (Bloque 3) -->
        <section id="prospectos" class="tabs">
            <div class="grid">
                <div class="card">
                    <h3><i class="fas fa-funnel-dollar"></i> Nuevo Prospecto</h3>
                    <label>Nombre</label>
                    <input id="pro-nom" placeholder="Nombre del prospecto">
                    <label>Materia</label>
                    <input id="pro-mat" placeholder="Ej: Laboral, Familia, Civil">
                    <label>Descripci√≥n</label>
                    <textarea id="pro-desc" placeholder="Descripci√≥n del caso..."></textarea>
                    <label>Complejidad</label>
                    <select id="pro-comp">
                        <option value="bajo">Baja</option>
                        <option value="medio">Media</option>
                        <option value="alto">Alta</option>
                    </select>
                    <label>Probabilidad de Cierre (%)</label>
                    <input type="number" id="pro-prob" placeholder="50" min="0" max="100">
                    <label>Honorario Propuesto ($)</label>
                    <input type="number" id="pro-hon" placeholder="0">
                    <button class="btn btn-s btn-full" onclick="uiCrearProspecto()"><i class="fas fa-save"></i>
                        Guardar Prospecto</button>
                </div>
                <div>
                    <div class="card" style="margin-bottom:14px;">
                        <h3><i class="fas fa-chart-bar"></i> Resumen Econ√≥mico</h3>
                        <div id="resumenEconomico"></div>
                    </div>
                    <div id="listaProspectos"></div>
                </div>
            </div>
        </section>

        <!-- CAUSAS PRO (Bloque 1 + 6) -->
        <section id="causas-pro" class="tabs">
            <div class="grid">
                <div class="card">
                    <h3><i class="fas fa-plus-circle"></i> Nueva Causa Pro</h3>
                    <label>Car√°tula</label>
                    <input id="cp-caratula" placeholder="Nombre de la causa">
                    <label>Tipo de Procedimiento</label>
                    <select id="cp-tipo">
                        <option value="Ordinario Civil">Ordinario Civil</option>
                        <option value="Ejecutivo">Ejecutivo</option>
                        <option value="Sumario">Sumario</option>
                        <option value="Familia">Familia</option>
                    </select>
                    <label>Rama / Materia</label>
                    <input id="cp-rama" placeholder="Ej: Civil, Laboral, Familia">
                    <button class="btn btn-s btn-full" onclick="uiCrearCausaPro()"><i class="fas fa-gavel"></i>
                        Crear Causa</button>
                </div>
                <div>
                    <div class="card" style="margin-bottom:14px;">
                        <h3><i class="fas fa-list-ol"></i> Causas del Sistema Pro</h3>
                        <div id="dashboardCausas"></div>
                    </div>
                    <div class="card">
                        <h3><i class="fas fa-file-plus"></i> Agregar Documento a Causa</h3>
                        <label>Seleccionar Causa</label>
                        <select id="doc-causa-sel"></select>
                        <label>Nombre del Documento</label>
                        <input id="doc-nombre" placeholder="Ej: Demanda principal">
                        <label>Tipo</label>
                        <select id="doc-tipo">
                            <option value="Resoluci√≥n">Resoluci√≥n</option>
                            <option value="Escrito">Escrito</option>
                            <option value="Prueba">Prueba</option>
                            <option value="Sentencia">Sentencia</option>
                            <option value="Notificaci√≥n">Notificaci√≥n</option>
                        </select>
                        <label>Etapa Vinculada</label>
                        <input id="doc-etapa" placeholder="Ej: Demanda interpuesta">
                        <label>Fecha del Documento</label>
                        <input type="date" id="doc-fecha">
                        <label class="cb-row" style="margin-top:10px; font-weight:600;">
                            <input type="checkbox" id="doc-genera-plazo" onchange="uiToggleDocPlazo()"> ¬øGenera
                            Plazo?
                        </label>
                        <div id="doc-plazo-extra"
                            style="display:none; margin-top:8px; padding:10px; background:#fffbeb; border-radius:8px;">
                            <label>D√≠as del Plazo</label>
                            <input type="number" id="doc-dias" placeholder="Ej: 10" min="1">
                        </div>
                        <button class="btn btn-p btn-full" onclick="uiAgregarDocumento()"><i class="fas fa-upload"></i>
                            Agregar Documento</button>
                        <div id="listaDocumentos" style="margin-top:14px;"></div>
                    </div>
                </div>
            </div>
        </section>

        <!-- CALENDARIO (Bloque 2) -->
        <section id="calendario" class="tabs">
            <div class="grid">
                <div class="card">
                    <h3><i class="fas fa-calendar-week"></i> Eventos y Plazos</h3>
                    <div style="display:flex; gap:8px; margin-bottom:14px; flex-wrap:wrap;">
                        <button class="btn btn-p" onclick="evaluarAlertas(); renderCalendario();">
                            <i class="fas fa-sync"></i> Actualizar Alertas
                        </button>
                        <button class="btn btn-sm" style="background:#ede9fe; color:#7c3aed; font-weight:600;"
                            onclick="exportarCalendarioICS()">
                            <i class="fas fa-calendar-plus"></i> Exportar a Calendario (.ics)
                        </button>
                    </div>
                    <div
                        style="padding:8px 12px; background:#f0fdf4; border-left:3px solid #22c55e; border-radius:6px; font-size:0.75rem; color:#14532d; margin-bottom:12px;">
                        <i class="fas fa-info-circle"></i> El archivo <strong>.ics</strong> es compatible con Google
                        Calendar, Apple Calendar y Outlook. Importarlo manualmente desde la app de calendario de su
                        preferencia.
                    </div>
                    <div id="calendarioEventos"></div>
                </div>
                <div class="card">
                    <h3><i class="fas fa-plus"></i> Crear Alerta Manual</h3>
                    <label>Causa Asociada</label>
                    <select id="cal-causa-sel">
                        <option value="">-- Sin causa espec√≠fica --</option>
                    </select>
                    <label>Tipo</label>
                    <select id="cal-tipo">
                        <option value="procesal">Procesal</option>
                        <option value="plazo">Plazo</option>
                        <option value="inactividad">Inactividad</option>
                        <option value="economica">Econ√≥mica</option>
                    </select>
                    <label>Mensaje</label>
                    <input id="cal-msg" placeholder="Descripci√≥n de la alerta">
                    <label>Fecha Objetivo</label>
                    <input type="date" id="cal-fecha">
                    <label>Prioridad</label>
                    <select id="cal-prioridad">
                        <option value="baja">Baja</option>
                        <option value="media">Media</option>
                        <option value="alta">Alta</option>
                        <option value="critica">Cr√≠tica</option>
                    </select>
                    <button class="btn btn-s btn-full" onclick="uiCrearAlerta()"><i class="fas fa-bell"></i> Crear
                        Alerta</button>
                </div>
            </div>
        </section>

        <!-- DOCTRINA & PR√ÅCTICA FORENSE -->
        <section id="doctrina" class="tabs">
            <div id="doctrina-main"></div>
        </section>

        <!-- ESTRATEGIA PRO (Bloque 7) -->
        <section id="estrategia-pro" class="tabs">
            <div class="grid">
                <div class="card">
                    <h3><i class="fas fa-chess"></i> Motor Estrat√©gico</h3>
                    <label>Seleccionar Causa Pro</label>
                    <select id="ep-causa-sel" onchange="uiRenderEstrategiaPro()">
                        <option value="">-- Seleccione una causa --</option>
                    </select>
                    <div style="margin-top:12px;margin-bottom:4px;">
                        <button
                            onclick="clAnalizarEstrategiaPro(parseInt(document.getElementById('ep-causa-sel').value))"
                            style="display:inline-flex;align-items:center;gap:8px;padding:10px 20px;background:linear-gradient(135deg,#7c3aed,#5b21b6);color:#fff;border:none;border-radius:9px;font-size:13px;font-weight:700;cursor:pointer;font-family:'DM Sans',sans-serif;box-shadow:0 2px 10px rgba(124,58,237,0.35);">
                            <i class="fas fa-brain"></i> An√°lisis Estrat√©gico con Bot AI
                        </button>
                    </div>
                    <div id="analisisEstrategico" style="margin-top:16px;"></div>
                </div>
                <div class="card">
                    <h3><i class="fas fa-book-open"></i> Jurisprudencia Avanzada</h3>

                    <!-- IMPORTAR FALLO CON IA -->
                    <div
                        style="background:#f5f3ff; border:1px solid #c4b5fd; border-radius:10px; padding:16px; margin-bottom:18px;">
                        <div style="display:flex; align-items:center; gap:8px; margin-bottom:10px;">
                            <span
                                style="background:#7c3aed; color:white; border-radius:6px; padding:3px 8px; font-size:0.68rem; font-weight:700; font-family:'DM Mono',monospace;">‚ú®
                                IA GEMINI</span>
                            <strong style="font-size:0.88rem;">Importar Fallo desde Texto</strong>
                        </div>
                        <p style="font-size:0.78rem; color:#5b21b6; margin-bottom:10px;">Pegue el texto completo de
                            un fallo copiado desde el Poder Judicial, Corte Suprema o Tribunal Constitucional. La IA
                            extraer√° y estructurar√° los datos autom√°ticamente.</p>
                        <textarea id="import-fallo-texto" placeholder="Pegue aqu√≠ el texto del fallo judicial..."
                            style="min-height:110px; font-size:0.8rem; border-color:#c4b5fd;"></textarea>
                        <button class="btn btn-full" style="background:#7c3aed; color:white; margin-top:8px;"
                            onclick="iaImportarFallo()">
                            <i class="fas fa-magic"></i> <span id="btn-import-fallo-txt">Analizar con IA e
                                Indexar</span>
                        </button>
                        <div id="import-fallo-status"
                            style="display:none; margin-top:8px; font-size:0.78rem; padding:8px 12px; border-radius:6px;">
                        </div>
                        <!-- DISCLAIMER IA -->
                        <div
                            style="margin-top:10px; padding:8px 12px; background:#fef3c7; border-left:3px solid #f59e0b; border-radius:6px; font-size:0.72rem; color:#92400e;">
                            <i class="fas fa-exclamation-triangle"></i> <strong>Aviso IA:</strong> El an√°lisis
                            generado por Gemini es referencial y puede contener errores. Verifique siempre los datos
                            extra√≠dos (ROL, fecha, holding) con el documento original antes de indexar. La IA no
                            reemplaza el criterio jur√≠dico del abogado.
                        </div>
                    </div>

                    <label>Tribunal</label>
                    <input id="jav-tribunal" placeholder="Ej: Corte Suprema">
                    <label>Rol</label>
                    <input id="jav-rol" placeholder="Ej: 1234-2024">
                    <label>Materia</label>
                    <input id="jav-materia" placeholder="Ej: Laboral">
                    <label>Procedimiento</label>
                    <input id="jav-proc" placeholder="Ej: Ordinario Civil">
                    <label>Tema Central</label>
                    <input id="jav-tema" placeholder="Resumen del tema del fallo">
                    <label>Tendencia</label>
                    <select id="jav-tend">
                        <option value="Favorable">Favorable</option>
                        <option value="Neutra">Neutra</option>
                        <option value="Desfavorable">Desfavorable</option>
                    </select>
                    <label>Relevancia</label>
                    <select id="jav-relev">
                        <option value="Alta">Alta</option>
                        <option value="Media">Media</option>
                        <option value="Baja">Baja</option>
                    </select>
                    <label>Palabras Clave (separadas por coma)</label>
                    <input id="jav-palabras" placeholder="Ej: prescripci√≥n, contrato, da√±o">
                    <button class="btn btn-p btn-full" onclick="uiCrearJurisprudencia()"><i class="fas fa-save"></i>
                        Indexar Jurisprudencia</button>
                    <div id="listaJurisprudencia" style="margin-top:14px;"></div>
                </div>
            </div>
        </section>



        <!-- BIT√ÅCORA (Bloque 8) -->
        <section id="bitacora" class="tabs">
            <div class="card" style="max-width:800px;">
                <h3><i class="fas fa-shield-alt"></i> Bit√°cora del Sistema</h3>
                <div style="display:flex; gap:8px; margin-bottom:14px;">
                    <button class="btn btn-p btn-sm" onclick="renderBitacora()"><i class="fas fa-sync"></i>
                        Actualizar</button>
                    <button class="btn btn-d btn-sm"
                        onclick="if(confirm('¬øLimpiar bit√°cora?')){DB.bitacora=[];guardarDB();renderBitacora();}"><i
                            class="fas fa-trash"></i> Limpiar</button>
                </div>
                <div id="bitacoraSistema"></div>
            </div>
        </section>

        <!-- DETALLE CAUSA (modal + secci√≥n) -->
        <section id="detalle-causa" class="tabs">
            <div id="detalle-causa-content">
                <div class="empty-state card"><i class="fas fa-gavel"></i>
                    <p>Seleccione una causa para ver su detalle.</p>
                </div>
            </div>
        </section>


        <!-- B√öSQUEDA GLOBAL -->
        <section id="busqueda" class="tabs">
            <div class="card" style="max-width:700px;">
                <h3><i class="fas fa-search"></i> B√∫squeda Global</h3>
                <div style="display:flex; gap:8px; margin-bottom:16px;">
                    <input id="busq-input" placeholder="Buscar causas, clientes, documentos, jurisprudencia..."
                        oninput="busquedaGlobal(this.value)" style="margin:0; flex:1;">
                    <button class="btn btn-p" onclick="busquedaGlobal(document.getElementById('busq-input').value)"><i
                            class="fas fa-search"></i></button>
                </div>
                <div style="display:flex; gap:6px; flex-wrap:wrap; margin-bottom:12px;" id="busq-filtros">
                    <button class="filter-btn active" onclick="setBusqFiltro('todo',this)">Todo</button>
                    <button class="filter-btn" onclick="setBusqFiltro('causas',this)">Causas</button>
                    <button class="filter-btn" onclick="setBusqFiltro('clientes',this)">Clientes</button>
                    <button class="filter-btn" onclick="setBusqFiltro('documentos',this)">Documentos</button>
                    <button class="filter-btn" onclick="setBusqFiltro('juris',this)">Jurisprudencia</button>
                </div>
                <div id="busq-resultados"></div>
            </div>
        </section>

        <!-- PRESCRIPCI√ìN -->
        <section id="prescripcion" class="tabs">
            <div class="card" style="max-width:700px;">
                <h3><i class="fas fa-hourglass-half"></i> Control de Prescripci√≥n</h3>
                <p style="font-size:0.83rem; color:var(--t2); margin-bottom:16px;">Plazos legales referenciales.
                    Verificar siempre con normativa vigente.</p>
                <button class="btn btn-p" style="margin-bottom:16px;" onclick="renderPrescripcion()"><i
                        class="fas fa-sync"></i> Calcular Prescripciones</button>
                <div id="prescripcion-lista"></div>
            </div>
        </section>

        <!-- RECURSOS (Segunda Instancia) -->
        <section id="recursos" class="tabs">
            <div class="grid">
                <div class="card">
                    <h3><i class="fas fa-undo"></i> Interponer Recurso</h3>
                    <label>Causa</label>
                    <select id="rec-causa-sel"></select>
                    <label>Tipo de Recurso</label>
                    <select id="rec-tipo">
                        <option value="Apelaci√≥n">Apelaci√≥n</option>
                        <option value="Casaci√≥n en la Forma">Casaci√≥n en la Forma</option>
                        <option value="Casaci√≥n en el Fondo">Casaci√≥n en el Fondo</option>
                        <option value="Nulidad">Nulidad</option>
                        <option value="Reposici√≥n">Reposici√≥n</option>
                        <option value="Aclaraci√≥n">Aclaraci√≥n</option>
                    </select>
                    <label>Fecha de Interposici√≥n</label>
                    <input type="date" id="rec-fecha">
                    <label>Tribunal Superior</label>
                    <input id="rec-tribunal" placeholder="Ej: Corte de Apelaciones de Santiago">
                    <label>Observaciones</label>
                    <textarea id="rec-obs" placeholder="Fundamentos del recurso..."></textarea>
                    <button class="btn btn-s btn-full" onclick="uiInterponerRecurso()"><i class="fas fa-save"></i>
                        Registrar Recurso</button>
                </div>
                <div class="card">
                    <h3><i class="fas fa-list"></i> Recursos Activos</h3>
                    <div id="recursos-lista"></div>
                </div>
            </div>
        </section>

        <!-- INFORME CAUSA -->
        <section id="informe" class="tabs">
            <div class="card" style="max-width:700px;">
                <h3><i class="fas fa-file-alt"></i> Generar Informe de Causa</h3>
                <label>Seleccionar Causa</label>
                <select id="inf-causa-sel" onchange="previewInforme()"></select>
                <div style="display:flex; gap:8px; margin-top:14px; flex-wrap:wrap;">
                    <button class="btn btn-p" onclick="generarInformeCausa()"><i class="fas fa-eye"></i> Generar
                        Informe</button>
                    <button class="btn btn-s" onclick="window.print()"><i class="fas fa-print"></i>
                        Imprimir</button>
                    <button class="btn" style="background:var(--bg-2,var(--bg));" onclick="exportarInformeTexto()"><i
                            class="fas fa-download"></i> Exportar .txt</button>
                    <button class="btn" style="background:linear-gradient(135deg,#1a3a6b,#0d5e8a);color:#fff;"
                        onclick="exportarInformeMejorado(document.getElementById('inf-causa-sel').value)">
                        <i class="fas fa-star"></i> Informe Pro (PDF)
                    </button>
                </div>
                <div id="informe-content" style="margin-top:20px;"></div>
            </div>
        </section>

        <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
                 GENERADOR DE ESCRITOS ‚Äî DUAL PRO v2
                 Layout: Panel Formulario (izq) + Visor A4 (der)
                 + Panel IA colapsable (fixed derecha)
            ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
        <section id="escritos" class="tabs" style="padding:0;">

            <!-- ‚îÄ‚îÄ BARRA SUPERIOR ‚îÄ‚îÄ -->
            <div class="esc-topbar">
                <div class="esc-topbar-left">
                    <i class="fas fa-balance-scale" style="color:var(--cyan);"></i>
                    <span class="esc-topbar-title">Generador de Escritos</span>
                    <span class="esc-topbar-badge">Dual Pro v2</span>
                </div>
                <div class="esc-topbar-right">
                    <button class="btn btn-sm" onclick="uiGuardarEscrito()" id="btn-guardar-escrito">
                        <i class="fas fa-save"></i> Guardar en Causa
                    </button>
                    <button class="btn btn-sm" onclick="uiExportarEscrito()" id="btn-exportar-escrito">
                        <i class="fas fa-download"></i> Exportar
                    </button>
                    <button class="btn btn-sm btn-success-outline" onclick="uiCopiarEscrito()" id="btn-copiar-escrito">
                        <i class="fas fa-copy"></i> Copiar
                    </button>
                    <button class="btn btn-sm" onclick="uiAplicarVariables()" id="btn-vars"
                        title="Reemplaza [VARIABLES] con datos reales de la causa">
                        <i class="fas fa-magic"></i> Variables
                    </button>
                    <button class="btn btn-sm btn-purple-outline" onclick="escToggleIA()" id="btn-panel-ia">
                        <i class="fas fa-robot"></i> Sugerencias IA
                    </button>
                </div>
            </div>

            <!-- ‚îÄ‚îÄ CONTENEDOR DUAL ‚îÄ‚îÄ -->
            <div class="esc-body">

                <!-- PANEL FORMULARIO -->
                <div class="esc-form-panel">

                    <!-- Toggle IA -->
                    <div class="esc-ia-row">
                        <div class="esc-ia-row-label">
                            <span class="badge badge-cyan">‚ú® GEMINI</span>
                            <span>Redacci√≥n con <span id="esc-ia-provider-label">IA</span></span>
                        </div>
                        <label class="esc-toggle">
                            <input type="checkbox" id="esc-modo-ia" onchange="uiToggleModoIA()">
                            <span class="esc-toggle-track"></span>
                        </label>
                    </div>

                    <div id="esc-ia-key-warn" class="esc-key-warn" style="display:none;">
                        <i class="fas fa-key"></i>
                        Configure su API Key en <strong>Sistema ‚Üí Configurar IA</strong>
                    </div>

                    <div class="form-group">
                        <label>Causa</label>
                        <select id="esc-causa-sel"></select>
                    </div>

                    <div class="form-group">
                        <label>Tipo de Escrito</label>
                        <select id="esc-tipo">
                            <!-- Se rellena din√°micamente por rellenarTiposEscritos() seg√∫n materia de la causa -->
                            <option value="demanda_civil_ordinaria">Demanda Civil ‚Äî Juicio Ordinario</option>
                        </select>
                    </div>

                    <div class="form-group" style="flex:1; display:flex; flex-direction:column;">
                        <label>Hechos y Antecedentes</label>
                        <textarea id="esc-hechos" style="flex:1; min-height:160px; resize:vertical;"
                            placeholder="Describa los hechos relevantes del caso, antecedentes, fundamentos espec√≠ficos para el tipo de escrito seleccionado..."></textarea>
                    </div>

                    <button class="btn btn-p btn-full" style="margin-top:12px;" onclick="uiGenerarEscrito()">
                        <i class="fas fa-magic"></i>
                        <span id="btn-generar-txt">Generar Borrador</span>
                    </button>

                    <div id="esc-aviso" class="esc-notice esc-notice-warn" style="display:none; margin-top:10px;">
                        <i class="fas fa-exclamation-triangle"></i>
                        <span>Este borrador es referencial. Debe ser revisado y adecuado por el abogado antes de su
                            presentaci√≥n.</span>
                    </div>
                    <div id="esc-disclaimer-ia" class="esc-notice esc-notice-info"
                        style="display:none; margin-top:8px;">
                        <i class="fas fa-robot"></i>
                        <span><strong>Generado con IA (Gemini):</strong> Los modelos de inteligencia artificial
                            pueden cometer errores. Este escrito NO debe presentarse sin revisi√≥n
                            profesional.</span>
                    </div>
                </div>

                <!-- PANEL VISOR -->
                <div class="esc-visor-panel">
                    <div class="esc-visor-header">
                        <div
                            style="display:flex; align-items:center; gap:8px; font-weight:600; font-size:13px; color:var(--text);">
                            <i class="fas fa-file-alt" style="color:var(--cyan);"></i>
                            <span id="esc-visor-titulo">Borrador ‚Äî Sin generar</span>
                        </div>
                        <span style="font-size:11px; color:var(--text-3); font-family:'DM Mono',monospace;">Times
                            New Roman ¬∑ 16pt</span>
                    </div>
                    <div class="esc-visor-body">
                        <div id="esc-loading-overlay"
                            style="display:none; position:absolute; inset:0; background:rgba(255,255,255,0.7); backdrop-filter:blur(2px); z-index:10; display:none; align-items:center; justify-content:center; flex-direction:column; gap:12px; border-radius:0 0 var(--r-lg) var(--r-lg);">
                            <div class="spinner"></div>
                            <div style="font-size:13px; color:var(--text-2); font-weight:500;">Gemini est√°
                                redactando el escrito‚Ä¶</div>
                        </div>
                        <div class="esc-documento" id="esc-preview">
                            <div
                                style="display:flex; flex-direction:column; align-items:center; justify-content:center; min-height:360px; text-align:center; color:var(--text-3);">
                                <div
                                    style="width:64px; height:64px; background:var(--border); border-radius:50%; display:flex; align-items:center; justify-content:center; font-size:24px; margin-bottom:16px; color:var(--text-3);">
                                    <i class="fas fa-file-signature"></i>
                                </div>
                                <p style="font-size:13px; line-height:1.6;">Seleccione una causa, complete los
                                    antecedentes<br>y presione <strong>Generar Borrador</strong>.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- PANEL IA LATERAL -->
            <aside id="esc-ia-panel" class="esc-ia-aside">
                <div class="esc-ia-aside-header">
                    <div style="display:flex; align-items:center; gap:8px;">
                        <i class="fas fa-robot" style="color:var(--cyan);"></i>
                        <strong>Sugerencias IA</strong>
                    </div>
                    <button class="btn-icon" onclick="escToggleIA()">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div id="esc-ia-panel-body" class="esc-ia-aside-body">
                    <div
                        style="display:flex; flex-direction:column; align-items:center; justify-content:center; min-height:200px; text-align:center; color:var(--text-3); gap:12px; padding:20px;">
                        <i class="fas fa-lightbulb" style="font-size:2rem;"></i>
                        <p style="font-size:12px; line-height:1.6;">Genera un escrito para ver sugerencias
                            estrat√©gicas de Gemini.</p>
                    </div>
                </div>
                <div class="esc-ia-aside-footer">
                    <i class="fas fa-exclamation-triangle" style="color:var(--warning); flex-shrink:0;"></i>
                    <span>La IA puede cometer errores. Verifique con criterio profesional.</span>
                </div>
            </aside>

        </section>

        <!-- ‚ïê‚ïê‚ïê HISTORIAL DE ESCRITOS ‚ïê‚ïê‚ïê -->
        <section id="historial-escritos" class="tabs">
            <div class="db-header"
                style="display:flex; align-items:center; justify-content:space-between; flex-wrap:wrap; gap:12px;">
                <div>
                    <h2 class="section-title"><i class="fas fa-history" style="color:var(--cyan);"></i> Historial de
                        Escritos</h2>
                    <p class="section-subtitle">Todos los escritos generados y guardados en el despacho</p>
                </div>
            </div>

            <!-- Filtros -->
            <div class="db-filtros"
                style="display:flex; gap:10px; flex-wrap:wrap; margin-bottom:18px; align-items:center;">
                <input type="text" id="hfilt-texto" placeholder="Buscar por tipo, causa o contenido‚Ä¶"
                    style="flex:1; min-width:200px;" oninput="historialFiltrar()">
                <select id="hfilt-origen" onchange="historialFiltrar()" style="min-width:130px;">
                    <option value="">Todos los or√≠genes</option>
                    <option value="ia">‚ú® Generado con IA</option>
                    <option value="catalogo">üìÑ Cat√°logo est√°tico</option>
                    <option value="plantilla">üìã Plantilla propia</option>
                    <option value="manual">Manual</option>
                </select>
                <label style="display:flex; align-items:center; gap:6px; font-size:13px; cursor:pointer;">
                    <input type="checkbox" id="hfilt-favoritos" onchange="historialFiltrar()">
                    <i class="fas fa-star" style="color:var(--warning);"></i> Solo favoritos
                </label>
            </div>

            <!-- Lista -->
            <div id="historial-escritos-lista">
                <div class="alert-empty" style="padding:40px;">
                    <i class="fas fa-history"
                        style="font-size:2rem; color:var(--text-3); display:block; margin-bottom:12px;"></i>
                    Cargando historial‚Ä¶
                </div>
            </div>
        </section>

        <!-- ‚ïê‚ïê‚ïê PLANTILLAS PERSONALIZADAS ‚ïê‚ïê‚ïê -->
        <section id="plantillas-escritos" class="tabs">
            <div class="db-header"
                style="display:flex; align-items:center; justify-content:space-between; flex-wrap:wrap; gap:12px;">
                <div>
                    <h2 class="section-title"><i class="fas fa-layer-group" style="color:var(--cyan);"></i>
                        Plantillas Personalizadas</h2>
                    <p class="section-subtitle">Crea y reutiliza tus propios modelos de escritos judiciales</p>
                </div>
                <div style="display:flex;gap:8px;">
                    <button class="btn btn-p" onclick="plantillaNueva()">
                        <i class="fas fa-plus"></i> Nueva Plantilla (Escrito)
                    </button>
                    <button class="btn" style="background:linear-gradient(135deg,#0891b2,#0d5e8a);color:#fff;"
                        onclick="tab('plantillas-texto')">
                        <i class="fas fa-file-alt"></i> Plantillas de Texto
                    </button>
                </div>
            </div>

            <!-- Lista de plantillas de escrito (existentes) -->
            <div id="plantillas-lista">
                <div class="alert-empty" style="padding:40px;">
                    <i class="fas fa-layer-group"
                        style="font-size:2rem; color:var(--text-3); display:block; margin-bottom:12px;"></i>
                    Cargando plantillas‚Ä¶
                </div>
            </div>
        </section>

        <!-- PLANTILLAS DE TEXTO PERSONALIZABLES v8 -->
        <section id="plantillas-texto" class="tabs">
            <div class="db-header"
                style="display:flex; align-items:center; justify-content:space-between; flex-wrap:wrap; gap:12px; margin-bottom:20px;">
                <div>
                    <h2 class="section-title"><i class="fas fa-file-alt" style="color:var(--cyan);"></i> Plantillas
                        de Texto Personalizables</h2>
                    <p class="section-subtitle">Crea modelos reutilizables con variables din√°micas: {{cliente}},
                        {{causa}}, {{fecha_hoy}}, etc.</p>
                </div>
                <button class="btn btn-p" onclick="ptNueva()">
                    <i class="fas fa-plus"></i> Nueva Plantilla
                </button>
            </div>

            <!-- Variables disponibles -->
            <div class="card" style="margin-bottom:16px; padding:14px 16px;">
                <div
                    style="font-size:12px;font-weight:700;color:var(--text-2);margin-bottom:8px;text-transform:uppercase;letter-spacing:.05em;">
                    Variables disponibles</div>
                <div style="display:flex;flex-wrap:wrap;gap:6px;">
                    <code class="pt-var-badge">{{cliente}}</code>
                    <code class="pt-var-badge">{{rut_cliente}}</code>
                    <code class="pt-var-badge">{{causa}}</code>
                    <code class="pt-var-badge">{{rit}}</code>
                    <code class="pt-var-badge">{{tribunal}}</code>
                    <code class="pt-var-badge">{{procedimiento}}</code>
                    <code class="pt-var-badge">{{rama}}</code>
                    <code class="pt-var-badge">{{etapa_actual}}</code>
                    <code class="pt-var-badge">{{fecha_hoy}}</code>
                    <code class="pt-var-badge">{{fecha_hoy_larga}}</code>
                    <code class="pt-var-badge">{{a√±o}}</code>
                    <code class="pt-var-badge">{{despacho}}</code>
                    <code class="pt-var-badge">{{abogado}}</code>
                </div>
            </div>

            <!-- Lista de plantillas de texto -->
            <div id="pt-lista"></div>
        </section>

        <!-- REGISTRO DE TIEMPO POR CAUSA (TIMESHEET) v8 -->
        <section id="timesheet" class="tabs">
            <div class="db-header"
                style="display:flex; align-items:center; justify-content:space-between; flex-wrap:wrap; gap:12px; margin-bottom:20px;">
                <div>
                    <h2 class="section-title"><i class="fas fa-stopwatch" style="color:var(--cyan);"></i> Registro
                        de Tiempo</h2>
                    <p class="section-subtitle">Control de horas trabajadas por causa para facturaci√≥n precisa</p>
                </div>
                <button class="btn" style="background:#475569;color:#fff;" onclick="tiempoExportarCSV()">
                    <i class="fas fa-file-csv"></i> Exportar CSV
                </button>
            </div>

            <div style="display:grid;grid-template-columns:1fr 1fr;gap:18px;">

                <!-- Panel izquierdo: cron√≥metro + entrada manual -->
                <div>
                    <!-- CRON√ìMETRO -->
                    <div class="card" style="margin-bottom:16px;">
                        <h4 style="font-size:13px;font-weight:700;margin-bottom:14px;color:var(--text-2);"><i
                                class="fas fa-clock"></i> Cron√≥metro</h4>
                        <div id="ts-cronometro-display"
                            style="font-size:2.8rem;font-weight:800;font-family:'DM Mono',monospace;color:var(--text);text-align:center;letter-spacing:.05em;padding:16px 0;">
                            00:00:00</div>
                        <label>Causa</label>
                        <select id="ts-cronometro-causa" style="margin-bottom:10px;"></select>
                        <label>Actividad (opcional)</label>
                        <input id="ts-descripcion" placeholder="Ej: Redacci√≥n de demanda‚Ä¶" style="margin-bottom:12px;">
                        <div style="display:flex;gap:8px;">
                            <button id="ts-btn-iniciar" class="btn btn-p" style="flex:1;"
                                onclick="tiempoCronometroIniciar(document.getElementById('ts-cronometro-causa').value)">
                                <i class="fas fa-play"></i> Iniciar
                            </button>
                            <button id="ts-btn-detener" class="btn btn-d" style="flex:1;" disabled
                                onclick="tiempoCronometroDetener()">
                                <i class="fas fa-stop"></i> Detener y Guardar
                            </button>
                        </div>
                    </div>

                    <!-- ENTRADA MANUAL -->
                    <div class="card">
                        <h4 style="font-size:13px;font-weight:700;margin-bottom:14px;color:var(--text-2);"><i
                                class="fas fa-keyboard"></i> Entrada Manual</h4>
                        <label>Causa</label>
                        <select id="ts-causa-sel" style="margin-bottom:8px;"></select>
                        <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-bottom:8px;">
                            <div>
                                <label>Horas</label>
                                <input type="number" id="ts-horas" min="0" max="24" placeholder="0">
                            </div>
                            <div>
                                <label>Minutos</label>
                                <input type="number" id="ts-minutos" min="0" max="59" placeholder="0">
                            </div>
                        </div>
                        <label>Descripci√≥n</label>
                        <input id="ts-descripcion-manual" placeholder="Ej: Audiencia preparatoria"
                            style="margin-bottom:8px;">
                        <label>Fecha</label>
                        <input type="date" id="ts-fecha" style="margin-bottom:12px;">
                        <button class="btn btn-p" style="width:100%;" onclick="tiempoRegistrarManual()">
                            <i class="fas fa-plus"></i> Registrar Tiempo
                        </button>
                    </div>
                </div>

                <!-- Panel derecho: resumen + registros -->
                <div>
                    <!-- Resumen por causa -->
                    <div class="card" style="margin-bottom:16px;">
                        <h4 style="font-size:13px;font-weight:700;margin-bottom:14px;color:var(--text-2);"><i
                                class="fas fa-chart-bar"></i> Horas por Causa</h4>
                        <div id="ts-resumen-causas"></div>
                    </div>

                    <!-- Registros recientes -->
                    <div class="card">
                        <h4 style="font-size:13px;font-weight:700;margin-bottom:14px;color:var(--text-2);"><i
                                class="fas fa-list"></i> Registros Recientes</h4>
                        <div id="ts-registros-lista"></div>
                    </div>
                </div>
            </div>
        </section>

        <!-- M√ìDULO CUANT√çA DIN√ÅMICA -->
        <section id="cuantia" class="tabs">
            <div class="grid">
                <div class="card">
                    <h3><i class="fas fa-coins"></i> Cuant√≠a en Disputa</h3>
                    <label>Causa Asociada (opcional)</label>
                    <select id="cq-causa-sel">
                        <option value="">-- Sin causa espec√≠fica --</option>
                    </select>
                    <label>Monto Original ($)</label>
                    <input type="number" id="cq-monto" placeholder="Ej: 25000000" oninput="calcularCuantia()">
                    <label>Fecha del Hecho / Deuda</label>
                    <input type="date" id="cq-fecha" oninput="calcularCuantia()">
                    <label>Tipo de Ajuste</label>
                    <select id="cq-tipo" onchange="calcularCuantia()">
                        <option value="ipc">IPC (reajustabilidad UF referencial)</option>
                        <option value="interes_legal">Inter√©s Legal (0.5% mensual)</option>
                        <option value="interes_corriente">Inter√©s Corriente (aprox. 1.2% mensual)</option>
                        <option value="ipc_interes">IPC + Inter√©s Legal (combinado)</option>
                        <option value="uf">Valor UF hist√≥rico referencial</option>
                    </select>
                    <label>Honorario Base (% o monto fijo)</label>
                    <div style="display:grid; grid-template-columns:1fr 1fr; gap:8px; margin-top:6px;">
                        <select id="cq-hon-tipo" onchange="calcularCuantia()">
                            <option value="escala">Escala escalonada</option>
                            <option value="pct">% fijo</option>
                            <option value="fijo">Monto fijo ($)</option>
                        </select>
                        <input type="number" id="cq-hon-val" placeholder="Ej: 15 o 1500000" oninput="calcularCuantia()">
                    </div>
                    <div id="cq-resultado" style="margin-top:14px;"></div>
                </div>
                <div class="card">
                    <h3><i class="fas fa-chart-line"></i> Proyecci√≥n en el Tiempo</h3>
                    <p style="font-size:0.78rem; color:var(--t2); margin-bottom:12px;">Evoluci√≥n del monto ajustado
                        por mes</p>
                    <div id="cq-grafico" style="min-height:180px;"></div>
                    <div
                        style="margin-top:16px; padding:12px; background:var(--bg); border-radius:8px; font-size:0.8rem;">
                        <p style="color:var(--t2); margin-bottom:6px;"><i class="fas fa-exclamation-circle"
                                style="color:var(--w)"></i> <strong>Aviso legal:</strong></p>
                        <p style="color:var(--t2);">Los valores son referenciales. El IPC y tasas de inter√©s real
                            deben verificarse con el Banco Central y normativa vigente. Este c√°lculo no constituye
                            asesor√≠a financiera ni legal.</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- CALCULADORA PRO -->
        <section id="calculadora-pro" class="tabs">
            <div class="grid">
                <!-- Configuraci√≥n Global -->
                <div class="card">
                    <h3><i class="fas fa-sliders-h"></i> Par√°metros Chile (Referencial)</h3>
                    <div style="display:grid; grid-template-columns:1fr 1fr; gap:12px;">
                        <div>
                            <label style="font-size:0.75rem;">Valor UF Actual ($)</label>
                            <input type="number" id="cp-uf-valor" value="37800" oninput="cpRecalcular()">
                        </div>
                        <div>
                            <label style="font-size:0.75rem;">Valor UTM Actual ($)</label>
                            <input type="number" id="cp-utm-valor" value="65000" oninput="cpRecalcular()">
                        </div>
                    </div>
                    <div style="margin-top:12px;">
                        <label style="font-size:0.75rem;">Tasa IPC Mensual (%)</label>
                        <input type="number" id="cp-ipc-valor" value="0.45" step="0.01" oninput="cpRecalcular()">
                    </div>
                    <div style="margin-top:12px;">
                        <label style="font-size:0.75rem;">Inter√©s Legal (%)</label>
                        <input type="number" id="cp-int-valor" value="0.5" step="0.1" oninput="cpRecalcular()">
                    </div>
                    <p style="font-size:0.72rem; color:var(--text-3); margin-top:12px; line-height:1.4;">
                        <i class="fas fa-info-circle"></i> Estos valores alimentan todos los c√°lculos financieros de
                        la App.
                    </p>
                </div>

                <!-- Calculadora -->
                <div class="card" style="box-shadow:var(--sh-2); border-left:4px solid var(--cyan);">
                    <h3><i class="fas fa-calculator"></i> Calculadora de Reajustes</h3>
                    <div style="margin-bottom:12px;">
                        <label style="font-size:0.75rem;">Monto Base</label>
                        <div style="display:flex; gap:8px;">
                            <input type="number" id="cp-monto" placeholder="Ej: 1000000" oninput="cpRecalcular()"
                                style="flex:2;">
                            <select id="cp-moneda" onchange="cpRecalcular()" style="flex:1;">
                                <option value="clp">CLP ($)</option>
                                <option value="uf">UF</option>
                                <option value="utm">UTM</option>
                            </select>
                        </div>
                    </div>
                    <div style="margin-bottom:12px;">
                        <label style="font-size:0.75rem;">Fecha de Inicio de Deuda</label>
                        <input type="date" id="cp-fecha-inicio" oninput="cpRecalcular()">
                    </div>
                    <div style="margin-bottom:12px;">
                        <label style="font-size:0.75rem;">Tipo de Reajuste</label>
                        <select id="cp-reajuste" onchange="cpRecalcular()">
                            <option value="ninguno">Sin reajuste (solo conversi√≥n)</option>
                            <option value="ipc">IPC simple</option>
                            <option value="interes_legal">Inter√©s Legal (0.5%)</option>
                            <option value="interes_corriente">Inter√©s Corriente (1.2%)</option>
                            <option value="mix">IPC + Inter√©s Legal</option>
                        </select>
                    </div>
                    <div id="cp-resultado" style="margin-top:16px;">
                        <p
                            style="text-align:center; color:var(--text-3); padding:20px; background:var(--bg); border-radius:8px; font-size:0.85rem;">
                            Complete los campos para calcular</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- ‚ïê‚ïê‚ïê FICHA DE ESTRATEGIA ‚ïê‚ïê‚ïê -->
        <section id="ficha-estrategia" class="tabs">
            <div class="grid">
                <div class="card">
                    <h3><i class="fas fa-chess-knight"></i> Ficha de Estrategia</h3>
                    <label>Causa</label>
                    <select id="fe-causa-sel" onchange="cargarFichaEstrategia()"></select>

                    <div class="ficha-seccion" style="margin-top:14px;">
                        <h4><i class="fas fa-list-ol" style="color:var(--a)"></i> I. HECHOS</h4>
                        <textarea id="fe-hechos"
                            placeholder="Describa los hechos relevantes de forma clara y cronol√≥gica..."
                            style="min-height:100px;" oninput="calcularProbabilidad()"></textarea>
                        <div style="margin-top:6px; display:flex; flex-wrap:wrap; gap:4px;">
                            <small style="color:var(--t2); font-size:0.7rem; width:100%; margin-bottom:2px;">Fortalezas
                                presentes:</small>
                            <span class="ficha-tag" onclick="toggleTag(this,'hechos')" data-val="documentados">üìÑ
                                Documentados</span>
                            <span class="ficha-tag" onclick="toggleTag(this,'hechos')" data-val="testigos">üë•
                                Testigos</span>
                            <span class="ficha-tag" onclick="toggleTag(this,'hechos')" data-val="cronologia_clara">üìÖ
                                Cronolog√≠a clara</span>
                            <span class="ficha-tag" onclick="toggleTag(this,'hechos')" data-val="sin_contradicciones">‚úì
                                Sin contradicciones</span>
                        </div>
                    </div>

                    <div class="ficha-seccion">
                        <h4><i class="fas fa-balance-scale" style="color:var(--a)"></i> II. DERECHO</h4>
                        <textarea id="fe-derecho" placeholder="Normas aplicables, doctrina y fundamentos jur√≠dicos..."
                            style="min-height:90px;" oninput="calcularProbabilidad()"></textarea>
                        <div style="margin-top:6px; display:flex; flex-wrap:wrap; gap:4px;">
                            <small style="color:var(--t2); font-size:0.7rem; width:100%; margin-bottom:2px;">Base
                                jur√≠dica:</small>
                            <span class="ficha-tag" onclick="toggleTag(this,'derecho')" data-val="norma_expresa">‚öñÔ∏è
                                Norma expresa</span>
                            <span class="ficha-tag" onclick="toggleTag(this,'derecho')"
                                data-val="jurisprudencia_favor">üìö Jurisp. favorable</span>
                            <span class="ficha-tag" onclick="toggleTag(this,'derecho')" data-val="doctrina_uniforme">üìñ
                                Doctrina uniforme</span>
                            <span class="ficha-tag" onclick="toggleTag(this,'derecho')" data-val="precedente_sala">üèõÔ∏è
                                Precedente sala</span>
                        </div>
                    </div>

                    <div class="ficha-seccion">
                        <h4><i class="fas fa-search" style="color:var(--a)"></i> III. EVIDENCIA</h4>
                        <textarea id="fe-evidencia"
                            placeholder="Medios probatorios disponibles: documentos, peritos, testigos..."
                            style="min-height:90px;" oninput="calcularProbabilidad()"></textarea>
                        <div style="margin-top:6px; display:flex; flex-wrap:wrap; gap:4px;">
                            <small style="color:var(--t2); font-size:0.7rem; width:100%; margin-bottom:2px;">Tipo de
                                prueba:</small>
                            <span class="ficha-tag" onclick="toggleTag(this,'evidencia')"
                                data-val="prueba_documental">üìã Documental</span>
                            <span class="ficha-tag" onclick="toggleTag(this,'evidencia')" data-val="prueba_pericial">üî¨
                                Pericial</span>
                            <span class="ficha-tag" onclick="toggleTag(this,'evidencia')"
                                data-val="prueba_testimonial">üó£Ô∏è Testimonial</span>
                            <span class="ficha-tag" onclick="toggleTag(this,'evidencia')"
                                data-val="prueba_confesional">‚úçÔ∏è Confesional</span>
                        </div>
                    </div>

                    <div class="ficha-seccion">
                        <h4><i class="fas fa-exclamation-triangle" style="color:var(--w)"></i> IV. RIESGOS Y
                            DEBILIDADES</h4>
                        <textarea id="fe-riesgos"
                            placeholder="Puntos d√©biles, riesgos procesales, argumentos contrarios..."
                            style="min-height:80px;" oninput="calcularProbabilidad()"></textarea>
                    </div>

                    <div style="display:flex; gap:8px; margin-top:14px; flex-wrap:wrap;">
                        <button class="btn btn-p" style="flex:1;" onclick="guardarFichaEstrategia()"><i
                                class="fas fa-save"></i> Guardar Ficha</button>
                        <button class="btn btn-sm" style="background:var(--bg-2,var(--bg));"
                            onclick="exportarFichaEstrategia()"><i class="fas fa-download"></i> Exportar</button>
                    </div>
                </div>

                <div>
                    <!-- PROBABILIDAD DE √âXITO -->
                    <div class="card" style="margin-bottom:14px;">
                        <h3><i class="fas fa-percentage"></i> Probabilidad de √âxito</h3>
                        <div class="prob-exito-wrap">
                            <div class="prob-exito-label">
                                <span style="font-size:0.83rem; color:var(--t2);" id="fe-prob-label">Complete la
                                    ficha para calcular</span>
                                <span class="prob-exito-valor" id="fe-prob-valor" style="color:var(--t2);">‚Äî</span>
                            </div>
                            <div class="prob-exito-bar">
                                <div class="prob-exito-fill" id="fe-prob-fill" style="width:0%; background:var(--t2);">
                                </div>
                            </div>
                            <div id="fe-prob-detalle" style="margin-top:10px; font-size:0.78rem; color:var(--t2);">
                            </div>
                        </div>

                        <!-- Factores del medidor -->
                        <div style="margin-top:16px;" id="fe-factores"></div>
                    </div>

                    <!-- FICHAS GUARDADAS -->
                    <div class="card">
                        <h3><i class="fas fa-archive"></i> Fichas Guardadas</h3>
                        <div id="fe-lista" style="margin-top:10px;"></div>
                    </div>
                </div>
            </div>
        </section>

        <!-- ‚ïê‚ïê‚ïê MATRIZ DE PRIORIDAD ‚ïê‚ïê‚ïê -->
        <section id="matriz-prioridad" class="tabs">
            <div class="card">
                <h3><i class="fas fa-sort-amount-down"></i> Matriz de Prioridad Inteligente</h3>
                <p style="font-size:0.8rem; color:var(--t2); margin:8px 0 16px;">√çndice calculado autom√°ticamente
                    ponderando: cercan√≠a de plazo (40%), monto en disputa (25%), complejidad (20%) y probabilidad de
                    √©xito (15%).</p>
                <div style="overflow-x:auto;">
                    <table class="matriz-tabla" id="matriz-tabla">
                        <thead>
                            <tr>
                                <th style="width:60px;">√çndice</th>
                                <th>Causa</th>
                                <th>Plazo</th>
                                <th>Complejidad</th>
                                <th>Prob. √âxito</th>
                                <th>Monto</th>
                                <th>Acci√≥n</th>
                            </tr>
                        </thead>
                        <tbody id="matriz-tbody"></tbody>
                    </table>
                </div>
            </div>
            <div class="card">
                <h3><i class="fas fa-info-circle"></i> C√≥mo se calcula el √çndice</h3>
                <div style="display:grid; grid-template-columns:repeat(4,1fr); gap:12px; margin-top:10px;">
                    <div style="text-align:center; padding:12px; background:var(--bg); border-radius:8px;">
                        <div
                            style="font-size:1.4rem; font-weight:700; color:var(--d); font-family:'DM Mono',monospace;">
                            40%</div>
                        <div style="font-size:0.75rem; color:var(--t2); margin-top:4px;">Cercan√≠a de Plazo</div>
                        <div style="font-size:0.68rem; color:var(--t2);">D√≠as restantes al pr√≥ximo vencimiento</div>
                    </div>
                    <div style="text-align:center; padding:12px; background:var(--bg); border-radius:8px;">
                        <div
                            style="font-size:1.4rem; font-weight:700; color:var(--w); font-family:'DM Mono',monospace;">
                            25%</div>
                        <div style="font-size:0.75rem; color:var(--t2); margin-top:4px;">Monto en Disputa</div>
                        <div style="font-size:0.68rem; color:var(--t2);">Cuant√≠a relativa al portafolio</div>
                    </div>
                    <div style="text-align:center; padding:12px; background:var(--bg); border-radius:8px;">
                        <div
                            style="font-size:1.4rem; font-weight:700; color:var(--a); font-family:'DM Mono',monospace;">
                            20%</div>
                        <div style="font-size:0.75rem; color:var(--t2); margin-top:4px;">Complejidad</div>
                        <div style="font-size:0.68rem; color:var(--t2);">Nivel de riesgo procesal y probatorio</div>
                    </div>
                    <div style="text-align:center; padding:12px; background:var(--bg); border-radius:8px;">
                        <div
                            style="font-size:1.4rem; font-weight:700; color:var(--s); font-family:'DM Mono',monospace;">
                            15%</div>
                        <div style="font-size:0.75rem; color:var(--t2); margin-top:4px;">Prob. de √âxito</div>
                        <div style="font-size:0.68rem; color:var(--t2);">Inverso: menor probabilidad = mayor
                            urgencia</div>
                    </div>
                </div>
            </div>
        </section>

        <!-- ‚ïê‚ïê‚ïê MAPA ECON√ìMICO ‚ïê‚ïê‚ïê -->
        <section id="mapa-economico" class="tabs">
            <div class="card">
                <h3><i class="fas fa-chart-bar"></i> Mapa Econ√≥mico del Estudio</h3>
                <div class="mapa-eco" id="mapa-eco-kpis"></div>
                <div class="eco-proyeccion" id="mapa-eco-proyeccion"></div>
            </div>
            <div class="grid">
                <div class="card">
                    <h3><i class="fas fa-chart-line"></i> Honorarios por Causa</h3>
                    <div id="mapa-eco-causas"></div>
                </div>
                <div class="card">
                    <h3><i class="fas fa-calendar-alt"></i> Proyecci√≥n Mensual</h3>
                    <div id="mapa-eco-proyeccion-mes"></div>
                    <div
                        style="margin-top:12px; padding:10px; background:#fafafa; border-radius:6px; font-size:0.75rem; color:var(--t2);">
                        <i class="fas fa-exclamation-circle" style="color:var(--w)"></i> Proyecci√≥n basada en ritmo
                        hist√≥rico registrado en el sistema.
                    </div>
                </div>
            </div>
        </section>

        <!-- ‚ïê‚ïê‚ïê CONTROL DE INSTANCIAS ‚ïê‚ïê‚ïê -->
        <section id="instancias" class="tabs">
            <div class="card">
                <h3><i class="fas fa-sitemap"></i> Control de Instancias</h3>
                <div style="display:flex; gap:10px; margin-bottom:14px; flex-wrap:wrap;">
                    <select id="inst-causa-sel" onchange="renderInstancias()" style="flex:1; max-width:300px;">
                        <option value="">-- Seleccione una causa --</option>
                    </select>
                    <button class="btn btn-p" onclick="uiAgregarInstancia()"><i class="fas fa-plus"></i> Nueva
                        Instancia</button>
                </div>
                <div id="inst-timeline"></div>
            </div>
            <div class="card">
                <h3><i class="fas fa-list"></i> Resumen de Instancias ‚Äî Todas las Causas</h3>
                <div id="inst-resumen-global"></div>
            </div>
        </section>

        <!-- ‚ïê‚ïê‚ïê COHERENCIA ESTRAT√âGICA ‚ïê‚ïê‚ïê -->
        <section id="coherencia" class="tabs">
            <div class="card">
                <h3><i class="fas fa-project-diagram"></i> Motor de Coherencia Estrat√©gica</h3>
                <p style="font-size:0.8rem; color:var(--t2); margin:8px 0 14px;">Cruza la ficha de estrategia con la
                    evidencia indexada y la jurisprudencia para detectar inconsistencias o fortalezas.</p>
                <select id="coh-causa-sel" onchange="analizarCoherencia()" style="margin-bottom:14px;">
                    <option value="">-- Seleccione una causa --</option>
                </select>
                <div id="coh-resultado"></div>
            </div>
            <div class="card">
                <h3><i class="fas fa-check-double"></i> Estado de Coherencia ‚Äî Todas las Causas</h3>
                <div id="coh-resumen-global"></div>
            </div>
        </section>


        <section id="admin-usuarios" class="tabs">
            <div class="page-header">
                <h2 class="page-title"><i class="fas fa-users-cog"></i> Gesti√≥n de Usuarios</h2>
                <p class="page-subtitle">Control de accesos, roles y permisos del sistema</p>
            </div>

            <div class="ia-grid-layout">
                <div class="ia-main-col">
                    <div class="card" style="padding: 24px; border-top: 4px solid var(--cyan);">
                        <div
                            style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                            <h3 style="margin:0;"><i class="fas fa-users"></i> Listado de Usuarios</h3>
                            <button class="btn btn-p" onclick="uiCrearUsuario()"><i class="fas fa-user-plus"></i> Nuevo
                                Usuario</button>
                        </div>

                        <div
                            style="padding:12px 16px; background:var(--warning-bg, #fffbeb); border:1px solid var(--warning-border, #fde68a); border-radius:8px; margin-bottom:20px; font-size:0.8rem; color:var(--text-2);">
                            <i class="fas fa-crown" style="color:#f59e0b;"></i> <strong>Cuenta Administrador:</strong>
                            Acceso total. Todo se almacena localmente en este dispositivo.
                        </div>

                        <div id="users-lista"></div>
                    </div>
                </div>

                <div class="ia-side-col">
                    <div class="card" style="padding: 24px; border-left: 4px solid var(--cyan);">
                        <h3 style="margin-bottom: 16px;"><i class="fas fa-shield-alt"></i> Permisos por Rol</h3>
                        <div style="overflow-x:auto;">
                            <table style="width:100%; border-collapse:collapse; font-size:0.75rem;">
                                <thead>
                                    <tr style="border-bottom:2px solid var(--border);">
                                        <th style="text-align:left; padding:6px 8px; color:var(--t2);">Acci√≥n</th>
                                        <th style="text-align:center; padding:4px;"><span
                                                class="user-role-badge urb-admin">Admin</span></th>
                                        <th style="text-align:center; padding:4px;"><span
                                                class="user-role-badge urb-abogado">Abo</span></th>
                                        <th style="text-align:center; padding:4px;"><span
                                                class="user-role-badge urb-asistente">Asist</span></th>
                                    </tr>
                                </thead>
                                <tbody id="permisos-tabla"></tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section id="config-ia" class="tabs">
            <div class="page-header">
                <h2><i class="fas fa-robot"></i> Configuraci√≥n de IA y Cloud</h2>
                <p>Configuraci√≥n de inteligencia artificial y almacenamiento en la nube</p>
            </div>

            <div id="ia-config-container"></div>
            <div id="drive-config-panel" style="margin-top:24px;"></div>
        </section>



        <!-- ‚ïê‚ïê‚ïê BIBLIOTECA DOCUMENTAL ‚ïê‚ïê‚ïê -->
        <section id="biblioteca" class="tabs">
            <div class="bib-header">
                <h2 style="margin:0;"><i class="fas fa-book-open" style="color:var(--a);"></i> Biblioteca Documental
                </h2>
                <div style="display:flex; gap:8px; align-items:center;">
                    <div class="bib-view-toggle">
                        <button class="bib-view-btn activo" id="bib-view-grid" onclick="bibSetView('grid',this)"><i
                                class="fas fa-th-large"></i></button>
                        <button class="bib-view-btn" id="bib-view-list" onclick="bibSetView('list',this)"><i
                                class="fas fa-list"></i></button>
                    </div>
                    <button class="btn btn-p" onclick="bibAgregarDocumento()"><i class="fas fa-plus"></i>
                        Agregar</button>
                </div>
            </div>
            <div class="bib-stats-bar" id="bib-stats"></div>
            <div style="display:flex; gap:10px; margin-bottom:10px; flex-wrap:wrap;">
                <input id="bib-search" placeholder="Buscar por nombre, causa, etiqueta..." oninput="bibRender()"
                    style="flex:1; min-width:200px;">
                <select id="bib-filtro-tipo" onchange="bibRender()" style="width:auto;">
                    <option value="">Todos los tipos</option>
                    <option value="pdf">PDF</option>
                    <option value="word">Word</option>
                    <option value="excel">Excel</option>
                    <option value="imagen">Imagen</option>
                    <option value="otro">Otro</option>
                </select>
                <select id="bib-filtro-causa" onchange="bibRender()" style="width:auto;">
                    <option value="">Todas las causas</option>
                </select>
                <select id="bib-filtro-etapa" onchange="bibRender()" style="width:auto;">
                    <option value="">Todas las etapas</option>
                    <option>Demanda</option>
                    <option>Notificaci√≥n</option>
                    <option>Contestaci√≥n</option>
                    <option>Prueba</option>
                    <option>Sentencia</option>
                    <option>Recurso</option>
                    <option>Ejecuci√≥n</option>
                    <option>General</option>
                </select>
            </div>
            <div class="bib-filtros" id="bib-tags-filtro">
                <span class="bib-tag activo" data-tag="" onclick="bibFiltroTag('',this)">Todos</span>
                <span class="bib-tag" data-tag="demanda" onclick="bibFiltroTag('demanda',this)">Demanda</span>
                <span class="bib-tag" data-tag="sentencia" onclick="bibFiltroTag('sentencia',this)">Sentencia</span>
                <span class="bib-tag" data-tag="recurso" onclick="bibFiltroTag('recurso',this)">Recurso</span>
                <span class="bib-tag" data-tag="pericial" onclick="bibFiltroTag('pericial',this)">Pericial</span>
                <span class="bib-tag" data-tag="contrato" onclick="bibFiltroTag('contrato',this)">Contrato</span>
                <span class="bib-tag" data-tag="poder" onclick="bibFiltroTag('poder',this)">Poder</span>
                <span class="bib-tag" data-tag="escrito" onclick="bibFiltroTag('escrito',this)">Escritos</span>
            </div>
            <div id="bib-contenedor" style="margin-top:12px;"></div>
        </section>

        <section id="seccion-whatsapp" class="tabs">
            <div style="max-width:640px; margin:0 auto; display:grid; gap:16px;">

                <!-- ‚îÄ‚îÄ CARD 1: Conexi√≥n + usuario activo ‚îÄ‚îÄ -->
                <div class="card-premium">
                    <div style="display:flex; align-items:center; gap:12px; margin-bottom:16px;">
                        <div class="icon-box-premium" style="background:#25D366; color:white; font-size:1.3rem;">
                            <i class="fab fa-whatsapp"></i>
                        </div>
                        <div style="flex:1; min-width:0;">
                            <h3 style="margin:0;">WhatsApp Alertas</h3>
                            <span id="wa-badge"
                                style="font-size:11px; padding:2px 8px; border-radius:20px; background:#ef4444; color:white;">Desconectado</span>
                        </div>
                        <button id="wa-btn-toggle" onclick="waToggle()" class="btn btn-p">Conectar</button>
                    </div>

                    <!-- QR wrap -->
                    <div id="wa-qr-wrap"
                        style="display:none; text-align:center; margin-bottom:16px; padding:16px; background:var(--bg); border-radius:12px;">
                        <p style="font-size:13px; color:var(--text-2); margin-bottom:10px;">
                            Escanea con WhatsApp ‚Üí Men√∫ ‚Üí <strong>Dispositivos vinculados</strong>
                        </p>
                        <img id="wa-qr-img" src="" alt="QR"
                            style="width:220px; height:220px; border-radius:12px; border:3px solid #25D366;" />
                        <p style="font-size:11px; color:var(--text-3); margin-top:10px;">Al escanear, la app te pedir√°
                            un nombre para identificar esta sesi√≥n.</p>
                    </div>

                    <!-- Usuario activo (visible s√≥lo cuando hay sesi√≥n) -->
                    <div id="wa-usuario-activo"
                        style="display:none; background:var(--bg); border-radius:10px; padding:12px 14px; margin-bottom:16px; border-left:3px solid #25D366;">
                        <div
                            style="font-size:10px; color:var(--text-3); text-transform:uppercase; letter-spacing:.5px; margin-bottom:6px;">
                            Sesi√≥n activa</div>
                        <div style="display:flex; align-items:center; gap:10px; flex-wrap:wrap;">
                            <div
                                style="width:36px; height:36px; border-radius:50%; background:#25D366; display:flex; align-items:center; justify-content:center; color:white; font-size:1.1rem; flex-shrink:0;">
                                <i class="fas fa-user"></i>
                            </div>
                            <div>
                                <div id="wa-activo-nombre" style="font-weight:700; font-size:0.95rem;">‚Äî</div>
                                <div id="wa-activo-numero" style="font-size:11px; color:var(--text-3);">‚Äî</div>
                            </div>
                            <div style="margin-left:auto; text-align:right;">
                                <div style="font-size:10px; color:var(--text-3);">Conectado desde</div>
                                <div id="wa-activo-desde" style="font-size:11px; color:#25D366; font-weight:600;">‚Äî
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Alertas autom√°ticas -->
                    <label
                        style="display:flex; align-items:center; gap:10px; cursor:pointer; padding:10px; background:var(--bg); border-radius:8px;">
                        <input type="checkbox" id="wa-activo" style="width:18px; height:18px;" />
                        <span style="font-size:0.88rem;">Alertas autom√°ticas <span style="color:var(--text-3);">(resumen
                                8AM + cr√≠ticas en tiempo real)</span></span>
                    </label>

                    <div style="display:flex; gap:10px; flex-wrap:wrap; margin-top:14px;">
                        <button id="wa-btn-resumen" onclick="waEnviarResumen()" class="btn"
                            style="background:#25D366; color:white; border:none;">
                            <i class="fab fa-whatsapp"></i> Enviar resumen ahora
                        </button>
                    </div>
                </div>

                <!-- ‚îÄ‚îÄ CARD 2: Reenv√≠o autom√°tico a n√∫mero destino ‚îÄ‚îÄ -->
                <div class="card-premium">
                    <div style="display:flex; align-items:center; gap:10px; margin-bottom:14px;">
                        <div
                            style="width:32px; height:32px; border-radius:8px; background:#eff6ff; display:flex; align-items:center; justify-content:center; color:#3b82f6; font-size:1rem; flex-shrink:0;">
                            <i class="fas fa-share"></i>
                        </div>
                        <div>
                            <h4 style="margin:0;">Reenv√≠o autom√°tico de reportes</h4>
                            <small style="color:var(--text-3); font-size:11px;">El dispositivo registrado reenviar√° los
                                reportes a este n√∫mero autom√°ticamente</small>
                        </div>
                    </div>

                    <div style="display:grid; gap:10px;">
                        <div>
                            <label
                                style="font-size:11px; color:var(--text-3); display:block; margin-bottom:4px; text-transform:uppercase; letter-spacing:.4px;">Nombre
                                del destinatario</label>
                            <input id="wa-dest-nombre" type="text" class="input-field" placeholder="Ej: Dr. Carlos Ruiz"
                                maxlength="80" />
                        </div>
                        <div>
                            <label
                                style="font-size:11px; color:var(--text-3); display:block; margin-bottom:4px; text-transform:uppercase; letter-spacing:.4px;">N√∫mero
                                destino (con c√≥digo de pa√≠s, sin +)</label>
                            <input id="wa-numero-alt" type="tel" class="input-field" placeholder="56912345678"
                                maxlength="15" oninput="waValidarNumeroAlt()" />
                            <small id="wa-numero-alt-error"
                                style="color:#ef4444; font-size:11px; display:none;"></small>
                        </div>
                    </div>

                    <!-- Destino guardado (visible cuando hay uno configurado) -->
                    <div id="wa-dest-activo"
                        style="display:none; margin-top:12px; padding:10px 12px; background:#f0fdf4; border-radius:8px; border:1px solid #bbf7d0; display:flex; align-items:center; gap:10px;">
                        <i class="fas fa-check-circle" style="color:#16a34a; font-size:1.1rem;"></i>
                        <div style="flex:1; min-width:0;">
                            <div style="font-size:12px; font-weight:600; color:#15803d;" id="wa-dest-activo-nombre">‚Äî
                            </div>
                            <div style="font-size:11px; color:#166534;" id="wa-dest-activo-numero">‚Äî</div>
                        </div>
                        <button onclick="waLimpiarDestino()" class="btn btn-sm"
                            style="background:transparent; color:#dc2626; border:1px solid #fca5a5; font-size:11px; padding:3px 8px;">
                            <i class="fas fa-times"></i> Quitar
                        </button>
                    </div>

                    <div style="display:flex; gap:10px; flex-wrap:wrap; margin-top:14px;">
                        <button onclick="waGuardarDestino()" class="btn btn-p"><i class="fas fa-save"></i> Guardar
                            destino</button>
                        <button id="wa-btn-enviar-alt" onclick="waEnviarAOtroNumero()" class="btn"
                            style="background:#25D366; color:white; border:none;">
                            <i class="fab fa-whatsapp"></i> Reenviar ahora
                        </button>
                    </div>
                </div>

                <!-- ‚îÄ‚îÄ CARD 3: Estad√≠sticas ‚îÄ‚îÄ -->
                <div class="card-premium" id="wa-stats-card" style="display:none;">
                    <h4 style="margin:0 0 12px;">üìä Actividad (√∫ltimas 24h)</h4>
                    <div style="display:grid; grid-template-columns:repeat(3,1fr); gap:10px; text-align:center;">
                        <div>
                            <div style="font-size:1.8rem; font-weight:800; color:#25D366" id="wa-stat-enviados">0</div>
                            <div style="font-size:11px; color:var(--text-3)">Enviados</div>
                        </div>
                        <div>
                            <div style="font-size:1.8rem; font-weight:800; color:#ef4444" id="wa-stat-errores">0</div>
                            <div style="font-size:11px; color:var(--text-3)">Errores</div>
                        </div>
                        <div>
                            <div style="font-size:1.8rem; font-weight:800; color:var(--warning)" id="wa-stat-cola">0
                            </div>
                            <div style="font-size:11px; color:var(--text-3)">En cola</div>
                        </div>
                    </div>
                    <div style="margin-top:10px; font-size:11px; color:var(--text-3);">√öltimo env√≠o: <span
                            id="wa-stat-ultimo">‚Äî</span></div>
                </div>

                <!-- ‚îÄ‚îÄ CARD 4: Log ‚îÄ‚îÄ -->
                <div class="card-premium" id="wa-log-card" style="display:none;">
                    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:12px;">
                        <h4 style="margin:0;">üìã Log de actividad</h4>
                        <button id="wa-limpiar" onclick="waLimpiarLogs()" class="btn btn-sm"
                            style="background:var(--bg-2); font-size:11px;">
                            <i class="fas fa-trash"></i> Limpiar
                        </button>
                    </div>
                    <div id="wa-log-list"
                        style="max-height:200px; overflow-y:auto; font-size:11.5px; font-family:'IBM Plex Mono',monospace; display:grid; gap:4px;">
                    </div>
                </div>

                <!-- ‚îÄ‚îÄ CARD 5: Reset ‚îÄ‚îÄ -->
                <div class="card-premium" style="border:1px solid #fca5a5; background:#fff5f5;">
                    <div
                        style="display:flex; align-items:center; justify-content:space-between; flex-wrap:wrap; gap:12px;">
                        <div>
                            <h4 style="margin:0 0 4px; color:#dc2626;">‚ö†Ô∏è Zona de reset</h4>
                            <small style="color:var(--text-3); font-size:11px;">Borra configuraci√≥n, logs y sesi√≥n
                                WhatsApp. Deber√°s escanear QR de nuevo.</small>
                        </div>
                        <button id="wa-btn-reset" onclick="waReset()" class="btn"
                            style="background:#dc2626; color:white; border:none; white-space:nowrap;">
                            <i class="fas fa-trash-alt"></i> Resetear todo
                        </button>
                    </div>
                </div>

            </div>
        </section>

        <!-- ‚îÄ‚îÄ Modal: Nombre de sesi√≥n (aparece tras escanear QR) ‚îÄ‚îÄ -->
        <div class="modal" id="modal-wa-nombre" onclick="if(event.target===this) cerrarModalWA()">
            <div class="modal-content" style="max-width:420px;">
                <div class="modal-header">
                    <h3><i class="fab fa-whatsapp" style="color:#25D366;"></i> WhatsApp conectado</h3>
                    <button onclick="cerrarModalWA()" class="modal-close">√ó</button>
                </div>
                <div style="padding:20px; display:grid; gap:14px;">
                    <p style="margin:0; font-size:0.9rem; color:var(--text-2);">
                        ‚úÖ El QR fue escaneado correctamente. Ingresa un nombre para identificar esta sesi√≥n en los
                        reportes.
                    </p>
                    <div>
                        <label
                            style="font-size:11px; color:var(--text-3); display:block; margin-bottom:4px; text-transform:uppercase; letter-spacing:.4px;">Tu
                            nombre (aparecer√° en los reportes)</label>
                        <input id="wa-modal-nombre" type="text" class="input-field" placeholder="Ej: Mar√≠a Gonz√°lez"
                            maxlength="80" />
                    </div>
                    <div>
                        <label
                            style="font-size:11px; color:var(--text-3); display:block; margin-bottom:4px; text-transform:uppercase; letter-spacing:.4px;">Tu
                            n√∫mero WhatsApp (con c√≥digo de pa√≠s, sin +)</label>
                        <input id="wa-modal-numero" type="tel" class="input-field" placeholder="56912345678"
                            maxlength="15" />
                        <small style="color:var(--text-3); font-size:10px; margin-top:3px; display:block;">Este n√∫mero
                            identifica la sesi√≥n registrada y se usar√° para enviar los reportes.</small>
                    </div>
                    <div style="display:flex; gap:10px; justify-content:flex-end;">
                        <button onclick="cerrarModalWA()" class="btn" style="background:var(--bg-2);">Cancelar</button>
                        <button onclick="waConfirmarSesion()" class="btn btn-p"><i class="fas fa-check"></i> Confirmar
                            sesi√≥n</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- ‚îÄ‚îÄ Modales globales (fuera de secciones, dentro de #app, position:fixed correcto) ‚îÄ‚îÄ -->
        <div class="modal" id="modal-nuevo-usuario" onclick="if(event.target===this)cerrarModal('modal-nuevo-usuario')">
            <div class="modal-content" style="max-width:460px;">
                <div class="modal-header">
                    <h3 id="modal-user-title"><i class="fas fa-user-plus"></i> Nuevo Usuario</h3><button
                        onclick="cerrarModal('modal-nuevo-usuario')" class="modal-close">√ó</button>
                </div>
                <div class="modal-body">
                    <input type="hidden" id="edit-user-id">
                    <label>Nombre completo *</label><input id="nu-nombre" placeholder="Ej: Mar√≠a Gonz√°lez">
                    <label>Usuario (login) *</label><input id="nu-usuario" placeholder="Ej: maria">
                    <label>Contrase√±a *</label><input type="password" id="nu-password"
                        placeholder="M√≠nimo 6 caracteres">
                    <label>Rol</label>
                    <select id="nu-rol" onchange="uiUpdatePermisosPrev()">
                        <option value="abogado">Abogado</option>
                        <option value="asistente">Asistente Legal</option>
                        <option value="readonly">Solo lectura</option>
                    </select>
                    <label>Color de avatar</label>
                    <div style="display:flex; gap:8px; flex-wrap:wrap; margin-bottom:10px;" id="color-picker">
                        <div class="avatar-color-opt" data-color="#1a3a6b"
                            style="width:26px;height:26px;border-radius:50%;background:#1a3a6b;cursor:pointer;"
                            onclick="selectAvatarColor(this)"></div>
                        <div class="avatar-color-opt" data-color="#0d7a5f"
                            style="width:26px;height:26px;border-radius:50%;background:#0d7a5f;cursor:pointer;"
                            onclick="selectAvatarColor(this)"></div>
                        <div class="avatar-color-opt" data-color="#7c3aed"
                            style="width:26px;height:26px;border-radius:50%;background:#7c3aed;cursor:pointer;"
                            onclick="selectAvatarColor(this)"></div>
                        <div class="avatar-color-opt" data-color="#b45309"
                            style="width:26px;height:26px;border-radius:50%;background:#b45309;cursor:pointer;"
                            onclick="selectAvatarColor(this)"></div>
                        <div class="avatar-color-opt" data-color="#c0392b"
                            style="width:26px;height:26px;border-radius:50%;background:#c0392b;cursor:pointer;"
                            onclick="selectAvatarColor(this)"></div>
                        <div class="avatar-color-opt" data-color="#0369a1"
                            style="width:26px;height:26px;border-radius:50%;background:#0369a1;cursor:pointer;"
                            onclick="selectAvatarColor(this)"></div>
                    </div>
                    <div
                        style="background:var(--bg); border-radius:8px; padding:10px; font-size:0.75rem; color:var(--t2); margin-bottom:10px;">
                        <strong>Permisos:</strong>
                        <div id="permisos-preview" style="margin-top:6px;"></div>
                    </div>
                    <div style="display:flex; gap:8px; margin-top:12px;">
                        <button class="btn btn-s" style="flex:1;" onclick="guardarUsuario()"><i class="fas fa-save"></i>
                            Guardar</button>
                        <button class="btn" style="flex:1;"
                            onclick="cerrarModal('modal-nuevo-usuario')">Cancelar</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="modal" id="modal-bib-add" onclick="if(event.target===this)cerrarModal('modal-bib-add')">
            <div class="modal-content" style="max-width:540px;">
                <div class="modal-header">
                    <h3><i class="fas fa-plus-circle"></i> Agregar a Biblioteca</h3><button
                        onclick="cerrarModal('modal-bib-add')" class="modal-close">√ó</button>
                </div>
                <div class="modal-body">
                    <label>Nombre del documento *</label>
                    <input id="bib-nombre" placeholder="Ej: Demanda Civil ‚Äî L√≥pez vs. Garc√≠a">
                    <label>Tipo</label>
                    <select id="bib-tipo">
                        <option value="pdf">PDF</option>
                        <option value="word">Word / DOCX</option>
                        <option value="excel">Excel</option>
                        <option value="imagen">Imagen</option>
                        <option value="otro">Otro</option>
                    </select>
                    <label>Causa asociada</label>
                    <select id="bib-causa-sel"></select>
                    <label>Etapa procesal</label>
                    <select id="bib-etapa">
                        <option value="General">General</option>
                        <option value="Demanda">Demanda</option>
                        <option value="Notificaci√≥n">Notificaci√≥n</option>
                        <option value="Contestaci√≥n">Contestaci√≥n</option>
                        <option value="Prueba">Prueba</option>
                        <option value="Sentencia">Sentencia</option>
                        <option value="Recurso">Recurso</option>
                        <option value="Ejecuci√≥n">Ejecuci√≥n</option>
                    </select>
                    <label>Etiquetas (separadas por coma)</label>
                    <input id="bib-tags" placeholder="Ej: demanda, civil, prescripci√≥n">
                    <label>Descripci√≥n</label>
                    <textarea id="bib-descripcion" rows="2" placeholder="Resumen breve..."></textarea>
                    <label>Fecha del documento</label>
                    <input type="date" id="bib-fecha">
                    <label>Versi√≥n</label>
                    <input id="bib-version" value="v1.0" style="width:100px;">
                    <div style="display:flex; gap:8px; margin-top:14px;">
                        <button class="btn btn-s" style="flex:1;" onclick="bibGuardarDocumento()"><i
                                class="fas fa-save"></i> Guardar</button>
                        <button class="btn" style="flex:1;" onclick="cerrarModal('modal-bib-add')">Cancelar</button>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- ‚ïê‚ïê MODAL GEN√âRICO DE INPUT (reemplaza todos los prompt() nativos) ‚ïê‚ïê -->
    <div class="modal-overlay" id="modal-input-generico">
        <div class="modal-box" style="max-width:480px;">
            <div class="modal-header">
                <h3 id="mig-titulo"><i class="fas fa-edit"></i> Editar</h3>
                <button class="modal-close" onclick="migCancelar()">√ó</button>
            </div>
            <div id="mig-body" style="padding:4px 0 8px;"></div>
            <div style="display:flex; gap:8px; margin-top:18px;">
                <button class="btn btn-p" style="flex:1;" onclick="migConfirmar()"><i class="fas fa-check"></i> <span
                        id="mig-btn-ok">Guardar</span></button>
                <button class="btn btn-sm" style="background:var(--bg-2,var(--bg)); color:var(--text-2);"
                    onclick="migCancelar()">Cancelar</button>
            </div>
        </div>
    </div>

    <!-- ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà
         HTML ‚Äî BLOQUE 3: MODALES Y OVERLAYS GLOBALES
    ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà -->

    <!-- MODAL PLAZOS CR√çTICOS AL LOGIN -->
    <div class="modal-overlay" id="modal-plazos-criticos">
        <div class="modal-box" style="max-width:540px;">
            <div class="modal-header">
                <h3 style="color:var(--d);"><i class="fas fa-exclamation-triangle"></i> ‚ö†Ô∏è Plazos Cr√≠ticos</h3>
                <button class="modal-close" onclick="cerrarModal('modal-plazos-criticos')">√ó</button>
            </div>
            <p style="font-size:0.83rem; color:var(--t2); margin-bottom:14px;">Los siguientes plazos vencen hoy o
                ma√±ana:</p>
            <div id="modal-plazos-content"></div>
            <button class="btn btn-s btn-full" style="margin-top:16px;"
                onclick="cerrarModal('modal-plazos-criticos')">Entendido ‚Äî Revisar√© los plazos</button>
        </div>
    </div>

    <!-- MODAL DETALLE CAUSA -->
    <div class="modal-overlay" id="modal-detalle" style="padding:12px;">
        <div class="modal-box" style="max-width:960px; width:100%; max-height:92vh; overflow-y:auto;">
            <div class="modal-header"
                style="position:sticky; top:0; background:var(--bg-card); z-index:10; border-radius:12px 12px 0 0; border-bottom:1px solid var(--border); padding:16px 20px;">
                <h3 id="modal-detalle-titulo" style="font-size:0.82rem; color:#64748b; font-weight:600;">Detalle de
                    Causa</h3>
                <button class="modal-close" onclick="cerrarModal('modal-detalle')">√ó</button>
            </div>
            <div id="modal-detalle-body" style="padding:20px;"></div>
        </div>
    </div>

    <!-- MODAL BUSCAR JURISPRUDENCIA -->
    <div class="modal-overlay" id="modal-buscar-juris">
        <div class="modal-box" style="max-width:600px;">
            <div class="modal-header">
                <h3><i class="fas fa-search"></i> Buscar & Asociar Jurisprudencia</h3>
                <button class="modal-close" onclick="cerrarModal('modal-buscar-juris')">√ó</button>
            </div>
            <input id="modal-juris-input" placeholder="Buscar por materia, tema o palabras clave..."
                oninput="uiBuscarJuris(this.value)" style="margin-bottom:12px;">
            <div id="modal-juris-resultados"></div>
        </div>
    </div>

    <!-- ‚îÄ‚îÄ MODAL HISTORIAL DE BACKUPS ‚îÄ‚îÄ -->

    <!-- ‚ïê‚ïê‚ïê MODAL PLANTILLA PERSONALIZADA ‚ïê‚ïê‚ïê -->
    <div class="modal-overlay" id="modal-plantilla" onclick="if(event.target===this)cerrarModal('modal-plantilla')">
        <div class="modal-content" style="max-width:680px; width:95%;">
            <div class="modal-header">
                <h3><i class="fas fa-layer-group" style="color:var(--cyan);"></i> Plantilla de Escrito</h3>
                <button class="btn-icon" onclick="cerrarModal('modal-plantilla')"><i class="fas fa-times"></i></button>
            </div>
            <div class="modal-body" style="display:flex; flex-direction:column; gap:14px;">

                <div style="display:grid; grid-template-columns:1fr 160px; gap:12px;">
                    <div class="form-group" style="margin:0;">
                        <label>Nombre de la plantilla <span style="color:var(--danger)">*</span></label>
                        <input type="text" id="plt-nombre" placeholder="Ej: Mi demanda de cobro de honorarios">
                    </div>
                    <div class="form-group" style="margin:0;">
                        <label>Materia</label>
                        <select id="plt-materia">
                            <option value="civil">Civil</option>
                            <option value="laboral">Laboral</option>
                            <option value="familia">Familia</option>
                            <option value="penal">Penal</option>
                            <option value="tributario">Tributario</option>
                            <option value="contencioso">Cont.-Adm.</option>
                        </select>
                    </div>
                </div>

                <div class="form-group" style="margin:0;">
                    <label>Descripci√≥n breve</label>
                    <input type="text" id="plt-descripcion" placeholder="Para qu√© sirve esta plantilla (opcional)">
                </div>

                <div class="form-group" style="margin:0;">
                    <label>Instrucciones para la IA
                        <span style="font-size:11px; color:var(--text-3); font-weight:400;">
                            ‚Äî Qu√© debe considerar Gemini al redactar con esta plantilla
                        </span>
                    </label>
                    <textarea id="plt-instrucciones" rows="3"
                        placeholder="Ej: Redactar conforme al Art. 254 CPC, con √©nfasis en la excepci√≥n de prescripci√≥n. Usar tono formal. Incluir siempre petici√≥n de costas‚Ä¶"></textarea>
                </div>

                <div class="form-group" style="margin:0;">
                    <label>Cuerpo / Estructura base
                        <span style="font-size:11px; color:var(--text-3); font-weight:400;">
                            ‚Äî Se cargar√° en el campo de hechos al usar la plantilla
                        </span>
                    </label>
                    <textarea id="plt-cuerpo" rows="6"
                        placeholder="I. HECHOS&#10;[Describir aqu√≠ los hechos relevantes]&#10;&#10;II. DERECHO&#10;[Art√≠culos aplicables]&#10;&#10;III. PETICI√ìN&#10;[Lo que se solicita al tribunal]"></textarea>
                </div>

                <div class="form-group" style="margin:0;">
                    <label>Etiquetas <span style="font-size:11px; color:var(--text-3); font-weight:400;">‚Äî separadas por
                            coma</span></label>
                    <input type="text" id="plt-tags" placeholder="Ej: cobro, ejecutivo, honorarios">
                </div>
            </div>
            <div class="modal-footer" style="display:flex; gap:10px; justify-content:flex-end;">
                <button class="btn" onclick="cerrarModal('modal-plantilla')">Cancelar</button>
                <button class="btn btn-p" onclick="plantillaGuardar()">
                    <i class="fas fa-save"></i> Guardar Plantilla
                </button>
            </div>
        </div>
    </div>

    <!-- MODAL CONFIRMACI√ìN -->
    <div class="modal-overlay" id="modal-confirm">
        <div class="modal-box" style="max-width:400px; text-align:center; padding:30px;">
            <div id="confirm-icon" style="font-size:3rem; color:var(--warning); margin-bottom:20px;">
                <i class="fas fa-exclamation-triangle"></i>
            </div>
            <h3 id="confirm-titulo" style="margin-bottom:10px;">¬øConfirmar acci√≥n?</h3>
            <p id="confirm-mensaje" style="color:var(--text-2); margin-bottom:25px; font-size:0.9rem;">Esta acci√≥n no se
                puede deshacer.</p>
            <div style="display:flex; gap:12px;">
                <button class="btn" style="flex:1;" onclick="cerrarModal('modal-confirm')">Cancelar</button>
                <button id="confirm-btn-ok" class="btn btn-p" style="flex:1;">Confirmar</button>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="modal-backups">
        <div class="modal-box" style="max-width:640px;">
            <div class="modal-header">
                <h3><i class="fas fa-history" style="color:var(--db-green,#0d7a5f)"></i> Historial de Backups
                    Autom√°ticos</h3>
                <button class="modal-close" onclick="cerrarModal('modal-backups')">√ó</button>
            </div>
            <p style="font-size:0.8rem; color:#64748b; margin-bottom:14px;">
                Se guardan los √∫ltimos <strong>5 snapshots</strong> autom√°ticos. Puedes restaurar cualquiera o crear uno
                manual ahora.
            </p>
            <div style="margin-bottom:14px;">
                <button class="btn btn-p btn-sm" onclick="AutoBackup.crearSnapshot('manual'); abrirHistorialBackups();">
                    <i class="fas fa-camera"></i> Crear Backup Manual Ahora
                </button>
            </div>
            <div id="backup-history-list"></div>
        </div>
    </div>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
         LEXIUM ‚Äî M√≥dulos JavaScript
         Orden de carga: dependencias primero, app core al final
    ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <!-- v13: EventBus + RenderBus + StorageGuard (debe ir PRIMERO) -->
    <script src="js/00-disk-storage.js"></script>
    <script src="js/00b-config.js"></script>
    <script src="js/00-eventbus.js"></script>
    <script src="js/01-db-auth.js"></script>
    <script src="js/02-render-crud.js"></script>
    <script src="js/03-causa-detail.js"></script>
    <script src="js/04-features.js"></script>
    <script src="js/05-business-engine.js"></script>
    <script src="js/06-calculators-strategy.js"></script>
    <script src="js/07-analytics-export.js"></script>
    <script src="js/08-dashboard.js"></script>
    <script src="js/09-app-core.js"></script>
    <script src="js/12-ia-providers.js"></script>
    <script src="js/10-ia-escritos.js"></script>
    <!-- M√ìDULO 11 ‚Äî Escritos: datos separados de UI (refactor v6) -->
    <script src="js/11a-escritos-data.js"></script>
    <script src="js/11b-escritos-ui.js"></script>
    <script src="js/13-features-v7.js"></script>
    <script src="js/14-features-v8.js"></script>
    <script src="js/15-tramites-admin.js"></script>
    <script src="js/16-doctrina.js"></script>
    <script src="js/16b-doctrina-pdf.js"></script>
    <script src="js/17-claude-legal.js"></script>
    <!-- v13: Google Drive F13 + RenderBus Wiring (al final ‚Äî despu√©s de todos los m√≥dulos) -->
    <script src="js/18-google-drive.js"></script>
    <script src="js/19-renderbus-wiring.js"></script>
    <script src="js/services/backup/backup-core.js"></script>
    <script src="js/services/backup/backup-ui.js"></script>
    <script src="js/20-backup-disco.js"></script>
    <script src="js/21-doc-fisico.js"></script>
    <script src="js/guardar-global.js"></script>
    <script src="js/22-whatsapp-panel-v2.js"></script>

    <!-- MODAL VERSIONES -->
    <div class="modal-overlay" id="modal-versiones" onclick="if(event.target===this)cerrarModal('modal-versiones')">
        <div class="modal" style="max-width:600px; width:100%;">
            <div class="modal-header">
                <h3 id="modal-versiones-titulo">Historial de Versiones</h3>
                <button class="btn-icon" onclick="cerrarModal('modal-versiones')"><i class="fas fa-times"></i></button>
            </div>
            <div class="modal-body" style="max-height:70vh; overflow-y:auto;">
                <div id="modal-versiones-lista"></div>
            </div>
            <div class="modal-footer">
                <button class="btn" onclick="cerrarModal('modal-versiones')">Cerrar</button>
            </div>
        </div>
    </div>


    <input type="file" id="adjunto-file-input" multiple accept=".pdf,.doc,.docx,.png,.jpg,.jpeg,.txt,.xlsx,.pptx"
        style="display:none;" onchange="adjuntosOnFileSelect(this)">

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <!-- MODALS & PANELS ‚Äî FEATURES v7                                       -->
    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->

    <!-- PANEL LATERAL DE NOTIFICACIONES -->
    <div id="notif-panel" class="notif-panel">
        <div class="notif-panel-header">
            <div style="display:flex;align-items:center;gap:8px;">
                <i class="fas fa-bell" style="color:var(--cyan,#0891b2);"></i>
                <span style="font-weight:700;font-size:15px;">Notificaciones</span>
            </div>
            <div style="display:flex;gap:6px;">
                <button class="btn btn-xs" onclick="notifMarcarTodasLeidas()" title="Marcar todas como le√≠das">
                    <i class="fas fa-check-double"></i>
                </button>
                <button class="btn btn-xs btn-danger-outline" onclick="notifLimpiarTodo()" title="Limpiar todo">
                    <i class="fas fa-trash"></i>
                </button>
                <button class="btn-icon" onclick="notifTogglePanel()" style="padding:4px 8px;">
                    <i class="fas fa-times"></i>
                </button>
            </div>
        </div>
        <div class="notif-panel-body">
            <div id="notif-lista"></div>
        </div>
    </div>
    <div id="notif-overlay" class="notif-overlay" onclick="notifTogglePanel()"></div>

    <!-- MODAL SELECCI√ìN PLANTILLA DE CAUSA -->
    <div class="modal-overlay" id="modal-plantilla-causa"
        onclick="if(event.target===this)cerrarModal('modal-plantilla-causa')">
        <div class="modal-content" style="max-width:700px;width:95%;max-height:85vh;overflow-y:auto;">
            <div class="modal-header">
                <div>
                    <h3><i class="fas fa-sitemap" style="color:var(--cyan,#0891b2);"></i> Crear Causa con Plantilla</h3>
                    <p style="font-size:12px;color:var(--text-3,#64748b);margin-top:2px;">Cliente: <strong
                            id="mpc-cliente-nombre"></strong></p>
                </div>
                <button class="btn-icon" onclick="cerrarModal('modal-plantilla-causa')"><i
                        class="fas fa-times"></i></button>
            </div>
            <input type="hidden" id="mpc-cliente-id">
            <div class="modal-body">
                <p style="font-size:13px;color:var(--text-2,#475569);margin-bottom:16px;">
                    Seleccione el procedimiento. Se crear√°n las etapas procesales y alertas de plazos t√≠picas
                    autom√°ticamente.
                </p>
                <div id="mpc-grid" class="mpc-grid"></div>
            </div>
        </div>
    </div>

    <!-- MODAL PERFIL EXPANDIDO CLIENTE ‚Üî CAUSAS -->
    <div class="modal-overlay" id="modal-perfil-cliente"
        onclick="if(event.target===this)cerrarModal('modal-perfil-cliente')">
        <div class="modal-content" style="max-width:760px;width:95%;max-height:88vh;overflow-y:auto;">
            <div class="modal-header">
                <div style="display:flex;align-items:center;gap:14px;">
                    <div class="mpc-avatar">
                        <i class="fas fa-user" style="font-size:1.4rem;color:var(--text-3,#64748b);"></i>
                    </div>
                    <div>
                        <h3 id="mpc-header-nombre" style="margin:0;font-size:17px;"></h3>
                        <div style="display:flex;gap:8px;align-items:center;margin-top:4px;">
                            <span id="mpc-header-rut"
                                style="font-size:12px;color:var(--text-3,#64748b);font-family:monospace;"></span>
                            <span id="mpc-header-estado" class="badge"></span>
                        </div>
                    </div>
                </div>
                <button class="btn-icon" onclick="cerrarModal('modal-perfil-cliente')"><i
                        class="fas fa-times"></i></button>
            </div>
            <div class="modal-body">
                <!-- KPIs del cliente -->
                <div class="mpc-kpis">
                    <div class="mpc-kpi-item">
                        <span class="mpc-kpi-val" id="mpc-kpi-causas">0</span>
                        <span class="mpc-kpi-lbl">Causas</span>
                    </div>
                    <div class="mpc-kpi-item">
                        <span class="mpc-kpi-val" id="mpc-kpi-pagado">$0</span>
                        <span class="mpc-kpi-lbl">Pagado</span>
                    </div>
                    <div class="mpc-kpi-item">
                        <span class="mpc-kpi-val" id="mpc-kpi-pendiente">$0</span>
                        <span class="mpc-kpi-lbl">Pendiente</span>
                    </div>
                    <div class="mpc-kpi-item">
                        <span class="mpc-kpi-val" id="mpc-kpi-docs">0</span>
                        <span class="mpc-kpi-lbl">Adjuntos</span>
                    </div>
                </div>
                <!-- Causas relacionadas -->
                <div style="display:flex;justify-content:space-between;align-items:center;margin:20px 0 10px;">
                    <h4 style="margin:0;font-size:14px;font-weight:700;">Causas Relacionadas</h4>
                    <button class="btn btn-xs btn-p" id="mpc-btn-nueva-causa">
                        <i class="fas fa-plus"></i> Nueva Causa
                    </button>
                </div>
                <div id="mpc-causas-lista"></div>
            </div>
        </div>
    </div>

    <!-- MODAL ACCI√ìN R√ÅPIDA (KPI Dashboard) -->
    <div class="modal-overlay" id="modal-accion-rapida"
        onclick="if(event.target===this)cerrarModal('modal-accion-rapida')">
        <div class="modal-content" style="max-width:400px;width:95%;">
            <div class="modal-header">
                <h3 id="mar-titulo" style="font-size:15px;margin:0;">Acci√≥n R√°pida</h3>
                <button class="btn-icon" onclick="cerrarModal('modal-accion-rapida')"><i
                        class="fas fa-times"></i></button>
            </div>
            <div class="modal-body" id="mar-body" style="padding:16px;"></div>
        </div>
    </div>

    <!-- MODAL ADJUNTOS (para causa espec√≠fica) -->
    <div class="modal-overlay" id="modal-adjuntos" onclick="if(event.target===this)cerrarModal('modal-adjuntos')">
        <div class="modal-content" style="max-width:560px;width:95%;">
            <div class="modal-header">
                <h3><i class="fas fa-paperclip" style="color:var(--cyan,#0891b2);"></i> Archivos Adjuntos</h3>
                <button class="btn-icon" onclick="cerrarModal('modal-adjuntos')"><i class="fas fa-times"></i></button>
            </div>
            <div class="modal-body" style="padding:16px;">
                <!-- Barra de uso -->
                <div style="margin-bottom:14px;">
                    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:4px;">
                        <span style="font-size:12px;font-weight:600;color:var(--text-2,#475569);">Almacenamiento</span>
                        <span id="adjuntos-uso-label"
                            style="font-size:11px;color:var(--text-3,#64748b);font-family:monospace;">0 MB / 50
                            MB</span>
                    </div>
                    <div style="height:6px;background:var(--bg-2,#f1f5f9);border-radius:3px;overflow:hidden;">
                        <div id="adjuntos-barra-uso"
                            style="height:100%;width:0%;border-radius:3px;transition:width 0.4s;background:#0d7a5f;">
                        </div>
                    </div>
                </div>
                <!-- Bot√≥n subir -->
                <button class="btn btn-p" onclick="adjuntosAbrir(document.getElementById('adjunto-causa-id').value)"
                    style="width:100%;margin-bottom:14px;">
                    <i class="fas fa-upload"></i> Adjuntar Archivo (&lt;2 MB ¬∑ PDF, Im√°genes, Word)
                </button>
                <input type="hidden" id="adjunto-causa-id">
                <!-- Lista -->
                <div id="adjuntos-lista"></div>
            </div>
        </div>
    </div>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <!-- MODALS ‚Äî FEATURES v8                                                 -->
    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->

    <!-- MODAL PLANTILLA DE TEXTO (CRUD) -->
    <div class="modal-overlay" id="modal-plantilla-texto"
        onclick="if(event.target===this)cerrarModal('modal-plantilla-texto')">
        <div class="modal-content" style="max-width:720px;width:95%;max-height:90vh;overflow-y:auto;">
            <div class="modal-header">
                <h3 id="pt-modal-titulo"><i class="fas fa-file-alt" style="color:var(--cyan);"></i> Nueva Plantilla de
                    Texto</h3>
                <button class="btn-icon" onclick="cerrarModal('modal-plantilla-texto')"><i
                        class="fas fa-times"></i></button>
            </div>
            <div class="modal-body" style="padding:20px;display:flex;flex-direction:column;gap:14px;">

                <div style="display:grid;grid-template-columns:1fr 160px;gap:12px;">
                    <div>
                        <label style="font-size:12px;font-weight:600;display:block;margin-bottom:4px;">Nombre <span
                                style="color:var(--danger)">*</span></label>
                        <input type="text" id="pt-nombre" placeholder="Ej: Demanda ejecutiva honorarios">
                    </div>
                    <div>
                        <label style="font-size:12px;font-weight:600;display:block;margin-bottom:4px;">Categor√≠a</label>
                        <select id="pt-categoria">
                            <option value="general">General</option>
                            <option value="demanda">Demanda</option>
                            <option value="recurso">Recurso</option>
                            <option value="notificacion">Notificaci√≥n</option>
                            <option value="contrato">Contrato</option>
                        </select>
                    </div>
                </div>

                <div>
                    <label style="font-size:12px;font-weight:600;display:block;margin-bottom:4px;">Descripci√≥n
                        breve</label>
                    <input type="text" id="pt-descripcion" placeholder="Para qu√© sirve esta plantilla">
                </div>

                <div>
                    <label style="font-size:12px;font-weight:600;display:block;margin-bottom:6px;">
                        Cuerpo de la Plantilla <span style="color:var(--danger)">*</span>
                        <span style="font-size:11px;font-weight:400;color:var(--text-3);margin-left:8px;">Use
                            {{variable}} para datos din√°micos</span>
                    </label>
                    <div style="display:flex;flex-wrap:wrap;gap:4px;margin-bottom:6px;">
                        <button class="pt-var-btn" onclick="ptInsertarVariable('cliente')">{{cliente}}</button>
                        <button class="pt-var-btn" onclick="ptInsertarVariable('causa')">{{causa}}</button>
                        <button class="pt-var-btn" onclick="ptInsertarVariable('tribunal')">{{tribunal}}</button>
                        <button class="pt-var-btn" onclick="ptInsertarVariable('fecha_hoy')">{{fecha_hoy}}</button>
                        <button class="pt-var-btn" onclick="ptInsertarVariable('rit')">{{rit}}</button>
                        <button class="pt-var-btn"
                            onclick="ptInsertarVariable('etapa_actual')">{{etapa_actual}}</button>
                        <button class="pt-var-btn" onclick="ptInsertarVariable('abogado')">{{abogado}}</button>
                        <button class="pt-var-btn" onclick="ptInsertarVariable('despacho')">{{despacho}}</button>
                    </div>
                    <textarea id="pt-cuerpo" rows="10"
                        placeholder="Escribe el cuerpo de la plantilla aqu√≠. Usa {{cliente}}, {{causa}}, {{fecha_hoy}}, etc."
                        style="font-family:'DM Mono',monospace;font-size:12px;resize:vertical;"></textarea>
                </div>

                <!-- Previsualizaci√≥n -->
                <div style="border:1px solid var(--border);border-radius:10px;overflow:hidden;">
                    <div
                        style="background:var(--bg-2);padding:10px 14px;display:flex;justify-content:space-between;align-items:center;">
                        <span style="font-size:12px;font-weight:600;color:var(--text-2);">Vista previa con
                            variables</span>
                        <div style="display:flex;gap:8px;align-items:center;">
                            <select id="pt-preview-causa" onchange="ptPrevisualizar()"
                                style="font-size:11px;padding:4px 8px;">
                                <option value="">Sin causa</option>
                            </select>
                            <button class="btn btn-xs" onclick="ptPrevisualizar()"><i class="fas fa-eye"></i>
                                Previsualizar</button>
                        </div>
                    </div>
                    <pre id="pt-preview-resultado"
                        style="padding:14px;font-family:'DM Mono',monospace;font-size:11px;white-space:pre-wrap;max-height:160px;overflow-y:auto;color:var(--text-2);background:var(--bg-card);margin:0;"></pre>
                </div>
            </div>
            <div class="modal-footer" style="display:flex;gap:10px;justify-content:flex-end;padding:14px 20px;">
                <button class="btn" onclick="cerrarModal('modal-plantilla-texto')">Cancelar</button>
                <button class="btn btn-p" onclick="ptGuardar()"><i class="fas fa-save"></i> Guardar Plantilla</button>
            </div>
        </div>
    </div>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
         LOGIN CANVAS ‚Äî Part√≠culas + Mesh de nodos + Balanza wireframe
         Solo activo cuando #login-screen es visible.
         Respeta prefers-reduced-motion.
    ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <script>
        (function () {
            'use strict';

            // Respetar prefers-reduced-motion
            if (window.matchMedia('(prefers-reduced-motion: reduce)').matches) return;

            const canvas = document.getElementById('login-canvas');
            if (!canvas) return;
            const ctx = canvas.getContext('2d');

            // ‚îÄ‚îÄ Paleta restringida: solo blancos/azules con opacidad baja ‚îÄ‚îÄ
            const C = {
                node: 'rgba(255,255,255,0.09)',
                nodeDot: 'rgba(6,182,212,0.22)',
                edge: 'rgba(6,182,212,0.07)',
                particle: 'rgba(255,255,255,0.13)',
                scale: 'rgba(6,182,212,0.13)',
                scaleFill: 'rgba(6,182,212,0.05)',
            };

            // ‚îÄ‚îÄ Estado ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
            let scaleAngle = 0;
            let scaleDir = 1;
            const SCALE_SPEED = 0.004;
            const SCALE_MAX = 0.09; // ~5 grados
            let W, H, raf, nodes, particles;
            const NODE_COUNT = 28;
            const PARTICLE_COUNT = 40;
            const CONNECT_DIST = 140;   // px: m√°xima distancia para trazar arista
            const NODE_SPEED = 0.12;  // muy lento
            const PART_SPEED = 0.18;

            // ‚îÄ‚îÄ Inicializar / redimensionar ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
            function resize() {
                const rect = canvas.parentElement.getBoundingClientRect();
                W = canvas.width = rect.width || canvas.offsetWidth;
                H = canvas.height = rect.height || canvas.offsetHeight;
                init();
            }

            function init() {
                nodes = Array.from({ length: NODE_COUNT }, () => ({
                    x: Math.random() * W,
                    y: Math.random() * H,
                    vx: (Math.random() - 0.5) * NODE_SPEED,
                    vy: (Math.random() - 0.5) * NODE_SPEED,
                    r: 1.2 + Math.random() * 1.4,
                }));
                particles = Array.from({ length: PARTICLE_COUNT }, () => ({
                    x: Math.random() * W,
                    y: Math.random() * H,
                    vx: (Math.random() - 0.5) * PART_SPEED,
                    vy: (Math.random() - 0.5) * PART_SPEED * 0.6 - 0.05,
                    r: 0.8 + Math.random() * 1.2,
                    alpha: 0.06 + Math.random() * 0.10,
                }));
            }

            // ‚îÄ‚îÄ Balanza jur√≠dica wireframe ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
            // Dibujada como geometr√≠a pura: trazo fino, muy baja opacidad.
            function drawScale(cx, cy, size, angle) {
                const s = size;
                ctx.save();
                ctx.strokeStyle = C.scale;
                ctx.fillStyle = C.scaleFill;
                ctx.lineWidth = 0.8;
                ctx.lineCap = 'round';
                ctx.lineJoin = 'round';

                // Pie (poste central)
                ctx.beginPath();
                ctx.moveTo(cx, cy + s * 0.55);
                ctx.lineTo(cx, cy - s * 0.30);
                ctx.stroke();

                // Base
                ctx.beginPath();
                ctx.moveTo(cx - s * 0.25, cy + s * 0.55);
                ctx.lineTo(cx + s * 0.25, cy + s * 0.55);
                ctx.stroke();

                // Travesa√±o horizontal ‚Äî animado con angle
                const armLen = s * 0.44;
                const armY = cy - s * 0.12;
                const ang = angle || 0;

                // Extremos del brazo rotado
                const lx = cx - armLen * Math.cos(ang);
                const ly = armY - armLen * Math.sin(ang);
                const rx = cx + armLen * Math.cos(ang);
                const ry = armY + armLen * Math.sin(ang);

                ctx.beginPath();
                ctx.moveTo(lx, ly);
                ctx.lineTo(rx, ry);
                ctx.stroke();

                // Punto central (balanc√≠n)
                ctx.beginPath();
                ctx.arc(cx, armY, 2.2, 0, Math.PI * 2);
                ctx.fillStyle = C.nodeDot;
                ctx.fill();

                // Cadenas + platillos
                const chainLen = s * 0.26;
                const platW = s * 0.22;
                const platH = s * 0.045;

                // Izquierdo ‚Äî cuelga del extremo rotado izquierdo
                ctx.beginPath();
                ctx.moveTo(lx, ly);
                ctx.lineTo(lx, ly + chainLen);
                ctx.stroke();
                ctx.beginPath();
                ctx.ellipse(lx, ly + chainLen, platW, platH, 0, 0, Math.PI * 2);
                ctx.fillStyle = C.scaleFill;
                ctx.fill();
                ctx.stroke();

                // Derecho ‚Äî cuelga del extremo rotado derecho
                ctx.beginPath();
                ctx.moveTo(rx, ry);
                ctx.lineTo(rx, ry + chainLen);
                ctx.stroke();
                ctx.beginPath();
                ctx.ellipse(rx, ry + chainLen, platW, platH, 0, 0, Math.PI * 2);
                ctx.fill();
                ctx.stroke();

                // Rayo de luz bajo el travesa√±o
                const grad = ctx.createLinearGradient(lx, ly, rx, ry);
                grad.addColorStop(0, 'transparent');
                grad.addColorStop(0.5, 'rgba(6,182,212,0.08)');
                grad.addColorStop(1, 'transparent');
                ctx.strokeStyle = grad;
                ctx.lineWidth = 1.5;
                ctx.beginPath();
                ctx.moveTo(lx, ly);
                ctx.lineTo(rx, ry);
                ctx.stroke();

                ctx.restore();
            }

            // ‚îÄ‚îÄ Tick principal ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
            function tick() {
                // Solo renderizar si login-screen es visible
                const screen = document.getElementById('login-screen');
                if (!screen || screen.style.display === 'none') {
                    cancelAnimationFrame(raf);
                    return;
                }

                ctx.clearRect(0, 0, W, H);

                // ‚Äî Aristas del mesh ‚Äî
                for (let i = 0; i < nodes.length; i++) {
                    for (let j = i + 1; j < nodes.length; j++) {
                        const dx = nodes[i].x - nodes[j].x;
                        const dy = nodes[i].y - nodes[j].y;
                        const d = Math.sqrt(dx * dx + dy * dy);
                        if (d < CONNECT_DIST) {
                            const alpha = (1 - d / CONNECT_DIST) * 0.10;
                            ctx.beginPath();
                            ctx.strokeStyle = `rgba(6,182,212,${alpha.toFixed(3)})`;
                            ctx.lineWidth = 0.5;
                            ctx.moveTo(nodes[i].x, nodes[i].y);
                            ctx.lineTo(nodes[j].x, nodes[j].y);
                            ctx.stroke();
                        }
                    }
                }

                // ‚Äî Nodos ‚Äî
                for (const n of nodes) {
                    // Mover
                    n.x += n.vx;
                    n.y += n.vy;
                    // Rebotar suavemente en los bordes
                    if (n.x < 0 || n.x > W) n.vx *= -1;
                    if (n.y < 0 || n.y > H) n.vy *= -1;
                    n.x = Math.max(0, Math.min(W, n.x));
                    n.y = Math.max(0, Math.min(H, n.y));

                    // Punto exterior (halo)
                    ctx.beginPath();
                    ctx.arc(n.x, n.y, n.r + 2, 0, Math.PI * 2);
                    ctx.fillStyle = C.node;
                    ctx.fill();
                    // Punto interior (n√∫cleo)
                    ctx.beginPath();
                    ctx.arc(n.x, n.y, n.r, 0, Math.PI * 2);
                    ctx.fillStyle = C.nodeDot;
                    ctx.fill();
                }

                // ‚Äî Part√≠culas flotantes ‚Äî
                for (const p of particles) {
                    p.x += p.vx;
                    p.y += p.vy;
                    // Reciclar si salen del canvas
                    if (p.x < -5) p.x = W + 5;
                    if (p.x > W + 5) p.x = -5;
                    if (p.y < -5) p.y = H + 5;
                    if (p.y > H + 5) p.y = -5;

                    ctx.beginPath();
                    ctx.arc(p.x, p.y, p.r, 0, Math.PI * 2);
                    ctx.fillStyle = `rgba(255,255,255,${p.alpha.toFixed(3)})`;
                    ctx.fill();
                }

                // ‚Äî Balanza wireframe (centrada en el panel, zona superior-media) ‚Äî
                // Actualizar √°ngulo de oscilaci√≥n de la balanza
                scaleAngle += SCALE_SPEED * scaleDir;
                if (Math.abs(scaleAngle) >= SCALE_MAX) scaleDir *= -1;

                // Balanza: m√°s a la derecha, m√°s grande ‚Äî como en Lovable
                drawScale(W * 0.63, H * 0.44, Math.min(W, H) * 0.36, scaleAngle);

                raf = requestAnimationFrame(tick);
            }

            // ‚îÄ‚îÄ Arrancar cuando el DOM est√© listo ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
            function start() {
                resize();
                // Observar cambios de tama√±o del panel
                if (typeof ResizeObserver !== 'undefined') {
                    new ResizeObserver(resize).observe(canvas.parentElement);
                } else {
                    window.addEventListener('resize', resize);
                }
            }
            start();
        })();
    </script>
    <script src="js/23b-prospectos-pdf.js"></script>
</body>

</html>